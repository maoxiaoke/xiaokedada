(window.webpackJsonp=window.webpackJsonp||[]).push([[113],{150:function(t,s,a){t.exports=a.p+"assets/img/ts-jest-error.e93480bb.jpg"},264:function(t,s,a){"use strict";a.r(s);var n=[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"从头到尾创建一个函数库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#从头到尾创建一个函数库","aria-hidden":"true"}},[this._v("#")]),this._v(" 从头到尾创建一个函数库")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"起项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#起项目","aria-hidden":"true"}},[this._v("#")]),this._v(" 起项目")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("创建文件夹")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bat extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("~ mkdir musejs\n~ cd musejs\n~ git init\n~ npm init\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"2"}},[s("li",[this._v("选择构建工具")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("(1) 首先，创建一个 "),s("code",[this._v("src")]),this._v(" 文件夹，并添加入口文件 "),s("code",[this._v("index.ts")]),this._v(";")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bat extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("npm install webpack --save-dev\nnpm install webpack-cli --save-dev\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("(3) 由于我会自定义编译配置，因此在根目录下创建一个 "),s("code",[this._v("webpack.config.js")]),this._v(" 文件，内容如下:")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// webpack.config.js")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" path "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'path'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nmodule"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  mode"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'none'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// 不需要 care 开发模式")]),t._v("\n  entry"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'./src/index.ts'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{attrs:{class:"token comment"}},[t._v("// 修改入口文件")]),t._v("\n  output"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    filename"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'main.js'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    path"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" path"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'dist'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("(4) 修改 "),s("code",[this._v("package.json")]),this._v(" 文件：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  ...\n  "),a("span",{attrs:{class:"token property"}},[t._v('"main"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"/dist/main.js"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  // 修改 publish 入口文件，相对位置设置\n  "),a("span",{attrs:{class:"token property"}},[t._v('"scripts"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"test"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"echo \\"Error: no test specified\\" && exit 1"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"build"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"webpack"')]),t._v("  // 添加 build 指令\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  ...\n  "),a("span",{attrs:{class:"token property"}},[t._v('"devDependencies"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"webpack"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"^4.39.3"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"webpack-cli"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"^3.3.7"')]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"3"}},[s("li",[this._v("用 Babel 转译代码")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bat extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("~ npm install -D babel-loader @babel/core @babel/preset-env\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// webpack.config.js")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n  module"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    rules"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        test"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token regex"}},[t._v("/\\.js$/")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        exclude"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token regex"}},[t._v("/node_modules/")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        loader"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"babel-loader"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{attrs:{class:"token comment"}},[t._v("// options: {")]),t._v("\n        "),a("span",{attrs:{class:"token comment"}},[t._v("//   presets: ['@babel/preset-env']")]),t._v("\n        "),a("span",{attrs:{class:"token comment"}},[t._v("// }")]),t._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("对于我而言，我并不喜欢将 babel 的配置项放到 webpack 或者 package.json 中(所以上面我注释掉了这段代码)。相反，我喜欢使用 "),s("code",[this._v(".babelrc")]),this._v(" 文件。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("第三步，新建 "),s("code",[this._v(".babelrc")]),this._v(" 文件，配置 preset。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token string"}},[t._v('"presets"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token string"}},[t._v('"@babel/preset-env"')]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"4"}},[s("li",[this._v("使用 TypeScript")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bat extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("~ npm install -D typescript\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bat extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("~ npm install -D @babel/preset-typescript @babel/plugin-proposal-class-properties @babel/plugin-proposal-object-rest-spread @babel/preset-env @babel/plugin-proposal-numeric-separator\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("(3) 配置 "),s("code",[this._v(".babelrc")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("// .babelrc\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token property"}},[t._v('"presets"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token string"}},[t._v('"@babel/preset-env"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"@babel/typescript"')]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token property"}},[t._v('"plugins"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token string"}},[t._v('"@babel/proposal-class-properties"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"@babel/proposal-object-rest-spread"')]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("(4) 添加 "),s("code",[this._v("tsconfig.json")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token property"}},[t._v('"compilerOptions"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"outDir"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"./dist/"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"noImplicitAny"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"module"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"es6"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"target"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"esnext"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" // 注意这里\n    "),a("span",{attrs:{class:"token property"}},[t._v('"jsx"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"react"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"declaration"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"moduleResolution"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"node"')]),t._v("\n    // "),a("span",{attrs:{class:"token property"}},[t._v('"allowJs"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("false")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" // 最好的是，我们不需要编译 .js 文件，是的这交给 babel 来做\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token property"}},[t._v('"include"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{attrs:{class:"token string"}},[t._v('"./src/"')]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("由于 TypeScript 也有相对 Babel 不是很灵活的 ES5 转译方式，为了避免重复操作，"),s("code",[this._v("target")]),this._v(" 定义为 "),s("code",[this._v("esnext")]),this._v(" 模式。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("留意的是我们将 "),s("code",[this._v("declaration")]),this._v(" 设置为 true, 来生成 "),s("code",[this._v(".d.ts")]),this._v(" 文件。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// webpack.config.js")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n  resolve"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    extensions"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token string"}},[t._v("'.ts'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'.tsx'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'.js'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'.json'")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  module"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    rules"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      test"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token regex"}},[t._v("/\\.(ts|js)x?$/")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      exclude"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token regex"}},[t._v("/node_modules/")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      loader"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'babel-loader'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("注意 "),a("code",[t._v("resolve")]),t._v(" 配置项，由于 "),a("code",[t._v("babel")]),t._v(" 默认值查找 "),a("code",[t._v(".js")]),t._v(" 文件，所以需要添加 "),a("code",[t._v(".ts")]),t._v(" 等文件的支持。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("至此为止，我们似乎省去了配置 "),a("code",[t._v("ts-loader")]),t._v(" 的烦恼。可是，当你运行 webpack 时，你会发现 "),a("code",[t._v("babel loader")]),t._v(" 为啥 "),a("strong",[t._v("没有对 "),a("code",[t._v(".ts")]),t._v(" 进行类型检查")]),t._v("。接下来我们要来补全这一行为。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bat extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("~ npm install -D fork-ts-checker-webpack-plugin\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("接着配置 "),s("code",[this._v("webpack.config.js")]),this._v(" 如下：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ForkTsCheckerWebpackPlugin "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("require")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'fork-ts-checker-webpack-plugin'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n\n  plugins"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("ForkTsCheckerWebpackPlugin")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"5"}},[s("li",[this._v("Lint")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bat extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("~ npm install -D eslint eslint-loader @typescript-eslint/parser @typescript-eslint/eslint-plugin\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[s("code",[this._v("@typescript-eslint/parser")]),this._v(" - eslint 用来 lint typescript 代码")]),s("li",[s("code",[this._v("@typescript-eslint/eslint-plugin")]),this._v(" - 专用于 typescript 的一个语法规则")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("(2) 新建 "),s("code",[this._v(".eslintrc")]),this._v(" 配置文件")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("// .eslintrc\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token property"}},[t._v('"parser"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"@typescript-eslint/parser"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token property"}},[t._v('"plugins"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token string"}},[t._v('"@typescript-eslint"')]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token property"}},[t._v('"rules"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{attrs:{class:"token property"}},[t._v('"extends"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{attrs:{class:"token string"}},[t._v('"eslint:recommended"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token string"}},[t._v('"plugin:@typescript-eslint/eslint-recommended"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token string"}},[t._v('"plugin:@typescript-eslint/recommended"')]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// webpack.config.js")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n  plugins"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("ForkTsCheckerWebpackPlugin")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      eslint"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bat extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("~ npm install -D standard\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("并修改 "),s("code",[this._v(".eslintrc")]),this._v(" 文件。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// .eslintrc")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n  "),a("span",{attrs:{class:"token string"}},[t._v('"extends"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n    standard\n    "),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("新建一个 "),s("code",[this._v(".eslintignore")]),this._v(" 文件：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-text extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("// .eslintignore\ndist/*\nnode_modules/*\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// webpack.config.js")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n  module"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    rules"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        enforce"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'pre'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        test"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token regex"}},[t._v("/\\.(ts|js)x?$/")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        exclude"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token regex"}},[t._v("/node_modules/")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        include"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token regex"}},[t._v("/src/")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        loader"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'eslint-loader'")]),t._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        test"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token regex"}},[t._v("/\\.(ts|js)x?$/")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        exclude"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token regex"}},[t._v("/node_modules/")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        loader"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'babel-loader'")]),t._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"6"}},[s("li",[this._v("Unit Test")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bat extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("npm i jest @types/jest ts-jest -D\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("仍然习惯新建一个文件来管理配置，所以新建 "),s("code",[this._v("jest.config.js")]),this._v(" 文件，如下：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  roots"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{attrs:{class:"token string"}},[t._v("'<rootDir>/src'")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  transform"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token string"}},[t._v("'^.+\\\\.[t|j]sx?$'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'ts-jest'")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("(3) 新建 "),s("code",[this._v("__test__")]),this._v(" 文件")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("对测试文件进行统一归类是一个好的习惯，因此在 "),a("code",[t._v("src")]),t._v(" 文件夹下新建一个 "),a("code",[t._v("__test__")]),t._v(" 用于存放测试文件，并且测试文件需要命名为 "),a("code",[t._v(".test.")]),t._v(" 的方式。由于我们使用的 "),a("code",[t._v("ts-jest")]),t._v("，因此文件以 "),a("code",[t._v(".test.ts")]),t._v(" 结尾(否则会遇到附录中的问题)。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("...\n  "),a("span",{attrs:{class:"token property"}},[t._v('"scripts"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"test"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"jest"')]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n...\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"7"}},[s("li",[this._v("为 package.json 添加 typings")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("为了生成 "),a("code",[t._v(".d.ts")]),t._v(" 文件，设置 "),a("code",[t._v("tsconfig.js")]),t._v(" 的 "),a("code",[t._v("declaration: true")]),t._v("。但同时希望忽略 "),a("code",[t._v("__test__")]),t._v(" 文件夹中的文件，因此添加配置 "),a("code",[t._v("exclude")]),t._v("：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n  "),a("span",{attrs:{class:"token string"}},[t._v('"exclude"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{attrs:{class:"token string"}},[t._v('"./src/__test__/"')]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("添加 "),s("code",[this._v("src")]),this._v(" 文件夹下的 "),s("code",[this._v("index.ts")]),this._v(" 如下：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("as")]),t._v(" sum "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'./sum'")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("运行指令 "),a("code",[t._v("tsc --emitDeclarationOnly")]),t._v(' (这个指令添加为 npm script "build:types")，会在 '),a("code",[t._v("dist")]),t._v(" 文件中生成 "),a("code",[t._v("index.d.ts")]),t._v(" 文件。将其添加到 "),a("code",[t._v("package.json")]),t._v("。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  ...\n  "),a("span",{attrs:{class:"token property"}},[t._v('"typings"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"dist/index.d.ts"')]),t._v("\n  ...\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"发布到-npm"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发布到-npm","aria-hidden":"true"}},[this._v("#")]),this._v(" 发布到 Npm")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bat extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("npm run publish\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("但是在此之前，通过 "),s("code",[this._v("npm adduser")]),this._v(" 或 "),s("code",[this._v("npm login")]),this._v(" 来添加发布者的信息。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"附录-遇到的问题汇总"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#附录-遇到的问题汇总","aria-hidden":"true"}},[this._v("#")]),this._v(" 附录 - 遇到的问题汇总")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("Cannot find module '@babel/types'. TS2307")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("如下图："),s("img",{attrs:{src:a(150),alt:"js-error"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("原因是使用了 "),s("code",[this._v("ts-jest")]),this._v("，但测试文件以 "),s("code",[this._v(".js")]),this._v(" 结尾，换成 "),s("code",[this._v(".ts")]),this._v(" 即可。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",{attrs:{start:"3"}},[s("li",[this._v("[warn] message TS151001: If you have issues related to imports, you should consider setting "),s("code",[this._v("esModuleInterop")]),this._v(" to "),s("code",[this._v("true")]),this._v(" in your TypeScript configuration file (usually "),s("code",[this._v("tsconfig.json")]),this._v(")")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("Webpack users may want to use this as well; however, your code should target esnext modules with a moduleResolution strategy of node. Using esnext modules with --esModuleInterop really only has the effect of turning on --allowSyntheticDefaultImports.")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("因此在 "),s("code",[this._v("tsconfig.js")]),this._v(" 文件中，我们添加一行配置：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// tsconfig.js")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n  "),a("span",{attrs:{class:"token string"}},[t._v('"compilerOptions"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n    "),a("span",{attrs:{class:"token string"}},[t._v('"allowSyntheticDefaultImports"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n")])])])}],e=a(0),r=Object(e.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),a("p",[t._v("这里记录从从头到尾搭建一个函数库的过程。")]),t._m(1),t._m(2),t._m(3),t._m(4),a("p",[t._v("这里选择 "),a("a",{attrs:{href:"https://webpack.js.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("webpack"),a("OutboundLink")],1),t._v(" 作为项目构建工具。实际以这个例子来说，"),a("a",{attrs:{href:"https://rollupjs.org/guide/en/",target:"_blank",rel:"noopener noreferrer"}},[t._v("rollup"),a("OutboundLink")],1),t._v(" 是比 webpack 简单的工具。但是由于我的私心(对 webpack 不是很熟，权当熟悉)，选择了 webpack。")]),t._m(5),a("p",[t._v("(2) 根据"),a("a",{attrs:{href:"https://webpack.js.org/guides/getting-started/",target:"_blank",rel:"noopener noreferrer"}},[t._v("官网"),a("OutboundLink")],1),t._v("的介绍，进行安装：")]),t._m(6),t._m(7),t._m(8),t._m(9),t._m(10),a("p",[t._v("(5) 添加 "),a("code",[t._v(".gitignore")]),t._v(" 文件。如果你使用的是 "),a("a",{attrs:{href:"https://code.visualstudio.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("VSCode"),a("OutboundLink")],1),t._v("，推荐 "),a("a",{attrs:{href:"https://marketplace.visualstudio.com/items?itemName=rubbersheep.gi",target:"_blank",rel:"noopener noreferrer"}},[t._v("Gi"),a("OutboundLink")],1),t._v(" 这个 extension。")]),t._m(11),a("p",[t._v("对于 "),a("a",{attrs:{href:"https://babeljs.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Babel"),a("OutboundLink")],1),t._v(" 集成 webpack 的方式，可以参考 "),a("a",{attrs:{href:"https://babeljs.io/setup#webpack",target:"_blank",rel:"noopener noreferrer"}},[t._v("babel#setup#webpack"),a("OutboundLink")],1),t._v(" 和 "),a("a",{attrs:{href:"https://webpack.js.org/loaders/babel-loader/#root",target:"_blank",rel:"noopener noreferrer"}},[t._v("babel-loader"),a("OutboundLink")],1),t._v(" 两个页面。")]),a("p",[t._v("第一步，安装核心依赖。")]),t._m(12),a("p",[t._v("其中 "),a("a",{attrs:{href:"https://babeljs.io/docs/en/babel-preset-env",target:"_blank",rel:"noopener noreferrer"}},[t._v("@babel/preset-env"),a("OutboundLink")],1),t._v(" 是标准 ES 代码转译为 ES5 代码的核心依赖，目前可能暂时只用到这个 preset。")]),a("p",[t._v("第二步，配置 loader。")]),t._m(13),t._m(14),t._m(15),t._m(16),t._m(17),a("p",[t._v("对于一个库而言，更为严格的 "),a("a",{attrs:{href:"http://www.typescriptlang.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("TypeScript"),a("OutboundLink")],1),t._v(" 必然是首选。TypeScript 集成 webpack, 可参考 "),a("a",{attrs:{href:"https://webpack.js.org/guides/typescript/#root",target:"_blank",rel:"noopener noreferrer"}},[t._v("TypeScript"),a("OutboundLink")],1),t._v(" 这个配置。")]),a("p",[t._v("传统的配置方式，需要按照 "),a("code",[t._v("ts-loader")]),t._v("。但是由于 TypeScript "),a("a",{attrs:{href:"https://iamturns.com/typescript-babel/",target:"_blank",rel:"noopener noreferrer"}},[t._v("拥抱 babel"),a("OutboundLink")],1),t._v("(官方 blog 可以参考"),a("a",{attrs:{href:"https://devblogs.microsoft.com/typescript/typescript-and-babel-7/",target:"_blank",rel:"noopener noreferrer"}},[t._v("这里 "),a("OutboundLink")],1),t._v(")，似乎不需要格外繁琐的配置了。")]),a("p",[t._v("参考 "),a("a",{attrs:{href:"https://github.com/Microsoft/TypeScript-Babel-Starter",target:"_blank",rel:"noopener noreferrer"}},[t._v("TypeScript-Babel-Starter"),a("OutboundLink")],1),t._v(" 的配置。")]),a("p",[t._v("(1) 安装 TypeScript")]),t._m(18),a("p",[t._v("(2) 安装对应的 TypeScript 需要的 Babel preset 和 plugins")]),t._m(19),t._m(20),t._m(21),t._m(22),t._m(23),t._m(24),t._m(25),a("p",[t._v("(5) 配置 webpack")]),t._m(26),t._m(27),t._m(28),a("p",[t._v("(6) "),a("a",{attrs:{href:"https://www.npmjs.com/package/fork-ts-checker-webpack-plugin",target:"_blank",rel:"noopener noreferrer"}},[t._v("fork-ts-checker-webpack-plugin"),a("OutboundLink")],1)]),a("p",[t._v("为了解决这个问题，会使用到 "),a("a",{attrs:{href:"https://www.npmjs.com/package/fork-ts-checker-webpack-plugin",target:"_blank",rel:"noopener noreferrer"}},[t._v("fork-ts-checker-webpack-plugin"),a("OutboundLink")],1),t._v(" 这个 webpack plugin。")]),t._m(29),t._m(30),t._m(31),a("p",[t._v(":::info\n值得高兴的是 TypeScript 拥抱 babel 以减少繁琐的配置。但必须看到其"),a("a",{attrs:{href:"https://kulshekhar.github.io/ts-jest/user/babel7-or-ts",target:"_blank",rel:"noopener noreferrer"}},[t._v("缺点"),a("OutboundLink")],1),t._v("，尤其是无法提供 type checking("),a("a",{attrs:{href:""}},[t._v("why")]),t._v(")。\n:::")]),t._m(32),a("p",[t._v("毫无疑问，我们会优先选择 "),a("a",{attrs:{href:"https://eslint.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("ESLint"),a("OutboundLink")],1),t._v("作为我们 "),a("a",{attrs:{href:"https://eslint.org/blog/2019/01/future-typescript-eslint#the-future-of-typescript-on-eslint",target:"_blank",rel:"noopener noreferrer"}},[t._v("TypeScript 代码的 Lint 工具"),a("OutboundLink")],1),t._v("。")]),a("p",[t._v("(1) 安装依赖")]),t._m(33),t._m(34),t._m(35),a("p",[a("a",{attrs:{href:"https://www.npmjs.com/package/@typescript-eslint/eslint-plugin",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考 @typescript-eslint/eslint-plugin"),a("OutboundLink")],1)]),t._m(36),a("p",[t._v("(3) 配置 fork-ts-checker-webpack-plugin")]),a("p",[t._v("如果我们要使用 fork-ts-checker-webpack-plugin 使用 eslint，需要在配置中开启 eslint 支持。")]),t._m(37),a("p",[t._v("(4) Standard 规范")]),a("p",[t._v("我是 "),a("a",{attrs:{href:"https://standardjs.com/readme-zhcn.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Standard"),a("OutboundLink")],1),t._v(" 代码规范的支持者，因此会在项目中提供 Standard 规范支持。")]),t._m(38),t._m(39),t._m(40),a("p",[t._v("(5) 忽略某些文件 Lint")]),t._m(41),t._m(42),a("p",[t._v("(6) 将 eslint 添加到 webpack.config.js")]),t._m(43),t._m(44),a("p",[t._v("单元测试工具选择 "),a("a",{attrs:{href:"https://jestjs.io/en/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Jest"),a("OutboundLink")],1),t._v("，是因为其对 TypeScript 相对友好。")]),a("p",[t._v("(1) 安装 Jest 和 ts-jest")]),a("p",[t._v("Jest 可以配合 Babel, 由于 "),a("a",{attrs:{href:"https://www.npmjs.com/package/babel-jest",target:"_blank",rel:"noopener noreferrer"}},[t._v("babel-jest"),a("OutboundLink")],1),a("a",{attrs:{href:"https://jestjs.io/docs/en/getting-started#using-typescript",target:"_blank",rel:"noopener noreferrer"}},[t._v("无法在编译时 type check 测试文件"),a("OutboundLink")],1),t._v("(是的，上面提到的原因)，因此选择的是 "),a("a",{attrs:{href:"https://github.com/kulshekhar/ts-jest",target:"_blank",rel:"noopener noreferrer"}},[t._v("ts-jest"),a("OutboundLink")],1),t._v("。")]),t._m(45),a("p",[t._v("(2) 新建 jest 配置项")]),t._m(46),t._m(47),t._m(48),t._m(49),a("p",[t._v("(4) 配置 npm script 指令")]),t._m(50),a("p",[t._v("接下来愉快地写测试代码吧。")]),t._m(51),t._m(52),t._m(53),t._m(54),t._m(55),t._m(56),t._m(57),t._m(58),a("p",[t._v("发布到 Npm 只需要一条指令：")]),t._m(59),t._m(60),a("p",[t._v(":::info\n发布前，现在 npm 上搜索是否有同名的库，不然可是发不上去哦。\n:::")]),t._m(61),t._m(62),a("p",[t._v("由于项目不使用 tsc 进行转译，所以 "),a("code",[t._v("tsconfig.js")]),t._v(" 文件中设置 "),a("code",[t._v('modules: "es6"')]),t._v("。但由于 ts 编译器默认使用 "),a("em",[t._v("classic")]),t._v(" 模块解析，因此如法解析非相对 "),a("code",[t._v("imports")]),t._v("。 "),a("a",{attrs:{href:"https://github.com/babel/babel/issues/10237",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考"),a("OutboundLink")],1)]),a("ol",{attrs:{start:"2"}},[a("li",[t._v('({"Object.'),a("anonymous",[t._v("\":function(module,exports,require,__dirname,__filename,global,jest){import sum from './sum'")])],1)]),t._m(63),t._m(64),t._m(65),a("p",[t._v("这是一个警告，内容参考 "),a("a",{attrs:{href:"https://devblogs.microsoft.com/typescript/announcing-typescript-2-7/#easier-ecmascript-module-interoperability",target:"_blank",rel:"noopener noreferrer"}},[t._v("Easier ECMAScript module interoperability"),a("OutboundLink")],1),t._v("。这是由于 ts 的模块策略和 webpack/babel 等不一致。最后一句：")]),t._m(66),t._m(67),t._m(68)])},n,!1,null,null,null);s.default=r.exports}}]);