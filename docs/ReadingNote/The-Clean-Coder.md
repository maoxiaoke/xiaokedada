# 代码整洁之道

完整的题目是「代码整洁之道 - 程序员的职业素养」。

## 成为专业人士

### 清楚自己要什么

第一个念头是：编程人员并不是*专业人士*。来做一个职业对比，律师，会计人员和证券师。相比之下，后三者会给人以专业的感觉，专业的感觉就是：当我们去询问他们什么时候可以完工，在获得确切的回答之后，就选择信任这种回答。

然而，在 项目经理、产品、测试等的眼里，程序员是天然的 *bug* 制造者。

所以，成为 *专业人士*，会产生别人的信任感，不会天然地认为程序员站在他们的对立面。

但是，*专业人士* 意味着 **责任与义务**。非专业人士放过了程序的一个 bug，导致公司的损失，会自我安慰：“难免要出点儿状况嘛”。但是专业人士，却必须为此负责。

### 上线未经测试的代码是不负责任的

对例行程序未进行测试就交付软件是不责任的。哪怕需要如期交付的产品，未经过测试，就该早点担起责任：“程序还未经测试，不能上线”。

因此，下面两点是重要的。

1. 让 QA 找不出任何问题。

故意发送明知有错误的代码给 QA，这种做法是及其不专业的；发送未经自测的代码的代码给 QA，这种做法是及其不专业的。

2. 要确保戴代码的正常运行

自测，一遍遍地测，翻来覆去、颠三倒四地测试。同时，为了解放我们的时间，必须对代码进行**百分百**的测试覆盖（自动化单元测试）。百分百当然是个理想的比例，但我们必须尽可能地覆盖。

*尽可能* 的解决方法是：设计易于测试的代码，最好是先写测试，再写要测的代码。

3. “无情” 重构

对每个模块，每次检查，都要比上次检查的时候更为简洁；每次阅读代码，都别忘了进行点滴地改善。

大多数的开发人员，认为对上线的代码不断地修改是危险的。但，让软件固定不变才是危险的。如果一直重构代码，等到不得不重构时，你就会发现代码已经 **僵化** 了。

为什么不改修改上下的代码呢，因为怕破坏线上正常运行的代码。为什么有这样的担心呢，因为他们完全没有对代码进行测试。

### “自由时间” 提升自我

留下 **20%** 的时间来提升自我。

其一就是，了解自己的领域。软件领域，一方面，各种观点、实践、技术和工具层出不穷。成为一名专业的开发者，就需要对其中的相当大的一部分有所了解，而且要不断扩展这方面的知识面。

其二，行业飞速发展。但是我们跟 50 年前一样，写着各种 `if...else` 语句。旧的理论和见解并不会全部过时，我们仍需要了解他们，需要知道它的长处和短处（必然是为了解决某些问题而提出来的）。

所以，以下的旧见解是必要的：

+ 设计模式 - GOF 书中的 24 种模式，以及 POSA 书中的多数模式的实战经验
+ 设计原则 - SOLID 设计原则，组件设计原则
+ 方法
+ 实践 - 掌握驱动开发设计，面向对象设计，结构化设计，持续集成等
+ 工作 - UML 图，DFD 图，结构图，Petri 网络图，状态转移图，流程图和决策图

提升编程能力，成为专业人才。要坚持学习、坚持练习；学会合作，结对编程，从彼此身上学到很多东西；辅导新人，传道受业的同时，自己也会从中受益；了解业务领域，满足雇主的要求；最后，要谦逊。

## 学会说“不”

::: tip
能就是能，不能就是不能，不要说 “试试看”。 -- 尤达
:::

### 专业人士要懂得说“不”

专业人士需要敢于说明真相而不屈服权威。假设，有一个急需上线的项目，上司想压缩你的开发时间。而你明明知道这点开发时间并不够，但是你可能会说：

- **“那好吧，我会尽量试试。”**

这相当不专业！为了完成任务，唯一的办法是怎么乱怎么来，顾不上代码的混乱了；而且，有的时候，事情远远要比开始时所说的要复杂的多 - 客户也许会增加新的功能，而你却要想法设法满足。

“试试看”的成本是什么呢？

意味着你要“付出额外的精力”；意味着你在许诺前是期待或确保成功的；意味着压力就要由你自己来抗了...，因此，要勇敢说“不”。

- **“不，这个项目需要 8 或者 9 周，而不是 4 周，那办不到！”。**

没有谁比专业人士更知道需要多少时间了。强调其中的不确定性，并且绝不退让。

## 说“是”

学会说“不”，是一种专业的表现。学会说”是“，同样是专业的表现。你，你自己，始终都能掌控某些事情，也就是说，总有些事是你可以承诺到的。

作出承诺，包含三个步骤：

1. **口头表达**自己将会去做。
2. **心里认真**对待做出的承诺。
3. **真正**付诸行动。

如何表达你的承诺。当承诺做某事时，应当留意自己的用词，因为某些用词透露了我们对待承诺的认真程度。比如，有一些短语和用词会透露“缺乏承诺”的蛛丝马迹。

+ 需要/应当。“我需要减肥”，“有人应当负责去推动这件事”。
+ 希望/但愿。“希望明天我能完成这个任务”，“但愿我有时间做这件事”。
+ 让我们(而不是 让我)。“让我们把这件事做完”，“让我们回头再见”。

作出真正的承诺的诀窍在于，要去搜寻与下列相似的语句： 我将在 ... 之前 ... (我将在周二之前完成这个任务)。这句话的关键在于，*你对自己将会做某件事做了清晰的试试陈述，而且还明确说明了完成期限。指明了做这件事的对象，不是别人，而是你自己。*。

当然，“言必信，行必果”。可万事都不是完美的。之所以没有成功，可能有以下原因。

1. 是因为我依赖第三方的进度

如果最终目标依赖于他人，那么你就应该采取某些措施，接近你的目标。比如，和依赖方坐到一起，彻底理清模块间的依赖关系。

2. 之所以没有成功，是因为我不太确信是否真能完成得了

即使目标无法达成，你仍能全力以赴，离目标更近些。

3. 之所以没有成功，是因为有些时候我真的无能为力

有些事情你先前没有预料到，这很现实。但如果你仍然希望自己能够不负众望，那就赶紧去调整别人对你的预期，**越快越好**！

你越早向各方发起预警信号，整个团队就越有可能抓住机会，终止并重新评估当前的活动，并决定是否应该采取一些措施或作出改变。

如果你不尽早告诉别人可能的问题，就错失了让他们帮你完成目标，兑现诺言的机会。

## 编码

编码是一项颇具挑战也十分累人的智力活动。相比其他类型的活动，编码要求更加聚精会神。

(1) 首先，代码必须正常工作
(2) 其次，代码必须能够解决客户提出的问题
(3) 再次，代码必须能和现有系统结合得天衣无缝 - 即，编写代码必须遵循稳健的过程
(4) 最后，其他程序员必须能够读懂你的代码

如果感到疲劳或心烦意乱，**千万不要编码**。

### 避免进入 “流态区”

“流态” 是一些程序员在编写代码时会进入的一种意识专注但思维视野却会收拢到狭窄的状态；这种状态下，他们会感到效率极高，会感到“绝无错误”。

但 “流态区” 并非真的极为高效，也绝非毫无错误。这其实是一种 “浅层冥想” 状态，在这种状态下，为了追求所谓的速度，理性思考的能力会下降。

当你感觉自己进入 “流态区”，就该走开几分钟或者去找一个结对编程的搭档。

### 音乐对 “编程” 毫无帮助

很多人写代码的时候喜欢戴着耳机。但，真实情况可能是，音乐正带领我们进入 “流态区”。

### 中断

中断无法避免，总有干扰会打断你、消耗你的时间。发生这种情况时要记住一点，也许下次也会轮到你去打断别人请求帮助。因此，礼貌地表现出乐于助人的态度才是专业的态度。

### 帮助他人

要清楚团队伙伴的状态。如果有人看起来遇到了麻烦，就应该向他提供帮助。给他人提供帮助并非说明你比人家聪明很多，而是因为你带了一个新的视角，对于解决问题起到了显著的催化作用。

帮助别人的时候，可以坐下来和他一起写代码，为此需要预留出一个小时甚至更长的时间。

### 接受他人的帮助

如果有人向你伸出援手，要诚挚接受，心怀感激地接受帮助并诚意合作。

要学会如何请求帮助。当你受阻时，或者有点犯晕时，或者只是绕一个问题绕不出去的时候，不防请求别人的帮助。

程序员大多自负、固执、内向。但是为了能够实现高效编程，好的协作至关重要。

## 测试驱动开发
