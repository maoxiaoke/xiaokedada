<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>AJAX | XIAOKEDADA</title>
    <meta name="description" content="Write something useful and funny">
    <link rel="icon" href="/favicon.png">
    
    <link rel="preload" href="/assets/css/41.styles.e762a268.css" as="style"><link rel="preload" href="/assets/js/app.410137e2.js" as="script"><link rel="preload" href="/assets/js/18.817df937.js" as="script"><link rel="prefetch" href="/assets/js/21.d6b1d746.js"><link rel="prefetch" href="/assets/js/1.92a2d4aa.js"><link rel="prefetch" href="/assets/js/2.39045e1a.js"><link rel="prefetch" href="/assets/js/3.2b022ecb.js"><link rel="prefetch" href="/assets/js/4.8e445ab4.js"><link rel="prefetch" href="/assets/js/5.84612907.js"><link rel="prefetch" href="/assets/js/6.15a5821d.js"><link rel="prefetch" href="/assets/js/7.06331f67.js"><link rel="prefetch" href="/assets/js/8.6c2278fd.js"><link rel="prefetch" href="/assets/js/9.ae547c14.js"><link rel="prefetch" href="/assets/js/10.7d5c0e89.js"><link rel="prefetch" href="/assets/js/11.f8684595.js"><link rel="prefetch" href="/assets/js/12.bff7ff72.js"><link rel="prefetch" href="/assets/js/13.c4b65b5e.js"><link rel="prefetch" href="/assets/js/14.245ecee9.js"><link rel="prefetch" href="/assets/js/15.8a7deb3e.js"><link rel="prefetch" href="/assets/js/16.0ca0755e.js"><link rel="prefetch" href="/assets/js/17.8909b53c.js"><link rel="prefetch" href="/assets/js/19.ee383a71.js"><link rel="prefetch" href="/assets/js/20.0a4da2de.js"><link rel="prefetch" href="/assets/js/0.2613590b.js"><link rel="prefetch" href="/assets/js/22.ebf4e4dd.js"><link rel="prefetch" href="/assets/js/23.b3a5d78d.js"><link rel="prefetch" href="/assets/js/24.24f6d16a.js"><link rel="prefetch" href="/assets/js/25.9b4594b3.js"><link rel="prefetch" href="/assets/js/26.f9cb806b.js"><link rel="prefetch" href="/assets/js/27.e45cf68a.js"><link rel="prefetch" href="/assets/js/28.5f710b0b.js"><link rel="prefetch" href="/assets/js/29.f2ebea39.js"><link rel="prefetch" href="/assets/js/30.e5541a7f.js"><link rel="prefetch" href="/assets/js/31.b78997b0.js"><link rel="prefetch" href="/assets/js/32.c7364e30.js"><link rel="prefetch" href="/assets/js/33.ae985e87.js"><link rel="prefetch" href="/assets/js/34.abe148b9.js"><link rel="prefetch" href="/assets/js/35.18140cbf.js"><link rel="prefetch" href="/assets/js/36.9493905a.js"><link rel="prefetch" href="/assets/js/37.7d93e401.js"><link rel="prefetch" href="/assets/js/38.0eb7992d.js"><link rel="prefetch" href="/assets/js/39.0cb28492.js"><link rel="prefetch" href="/assets/js/40.fde62018.js">
    <link rel="stylesheet" href="/assets/css/41.styles.e762a268.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      XIAOKEDADA
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/JavaScript/" class="nav-link router-link-active">JavaScript</a></div><div class="nav-item"><a href="/FirstMeet/" class="nav-link">FirstMeet系列</a></div><div class="nav-item"><a href="/CSS/" class="nav-link">CSS</a></div><div class="nav-item"><a href="/ReadingNote/" class="nav-link">读书笔记</a></div><div class="nav-item"><a href="/GatherAll/" class="nav-link">R &amp; T</a></div><a href="https://github.com/maoxiaoke/xiaokedada" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/JavaScript/" class="nav-link router-link-active">JavaScript</a></div><div class="nav-item"><a href="/FirstMeet/" class="nav-link">FirstMeet系列</a></div><div class="nav-item"><a href="/CSS/" class="nav-link">CSS</a></div><div class="nav-item"><a href="/ReadingNote/" class="nav-link">读书笔记</a></div><div class="nav-item"><a href="/GatherAll/" class="nav-link">R &amp; T</a></div><a href="https://github.com/maoxiaoke/xiaokedada" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>Depth-in-Series</span><!----></p><ul class="sidebar-group-items"><li><a href="/JavaScript/Require-and-Import.html" class="sidebar-link">require 和 import 的难点</a></li><li><a href="/JavaScript/Property-Descriptors.html" class="sidebar-link">JavaScript 对象的 Property descriptors</a></li><li><a href="/JavaScript/Depth-in-ES6.html" class="sidebar-link">深入理解 ES6</a></li><li><a href="/JavaScript/Depth-in-This.html" class="sidebar-link">让人头疼的函数内this的指向</a></li><li><a href="/JavaScript/Depth-in-Closure.html" class="sidebar-link">来一次痛痛快快得闭包挑战</a></li><li><a href="/JavaScript/Async-Programming.html" class="sidebar-link">JavaScript 异步编程</a></li><li><a href="/JavaScript/Prototype.html" class="sidebar-link">再谈原型和继承</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>基础内容</span><!----></p><ul class="sidebar-group-items"><li><a href="/JavaScript/AJAX.html" class="active sidebar-link">AJAX</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/JavaScript/AJAX.html#step-1-发出http请求" class="sidebar-link">step 1 : 发出HTTP请求</a></li><li class="sidebar-sub-header"><a href="/JavaScript/AJAX.html#step-2-处理服务器请求" class="sidebar-link">step 2 : 处理服务器请求</a></li><li class="sidebar-sub-header"><a href="/JavaScript/AJAX.html#使用数据" class="sidebar-link">使用数据</a></li><li class="sidebar-sub-header"><a href="/JavaScript/AJAX.html#取消异步请求" class="sidebar-link">取消异步请求</a></li><li class="sidebar-sub-header"><a href="/JavaScript/AJAX.html#example" class="sidebar-link">example</a></li><li class="sidebar-sub-header"><a href="/JavaScript/AJAX.html#ajax-跨域" class="sidebar-link">Ajax 跨域</a></li></ul></li><li><a href="/JavaScript/Coercion.html" class="sidebar-link">强制类型转换</a></li><li><a href="/JavaScript/Map-and-Reduce.html" class="sidebar-link">JavaScript 的 map/reduce</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>DOM 相关</span><!----></p><ul class="sidebar-group-items"><li><a href="/JavaScript/DOM-Operation.html" class="sidebar-link">原生JavaScript的DOM操作</a></li><li><a href="/JavaScript/DOM-More.html" class="sidebar-link">再来仔细研究DOM</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Thinking-in-JavaScript</span><!----></p><ul class="sidebar-group-items"><li><a href="/JavaScript/Small-and-Chunk-Code.html" class="sidebar-link">书写有用而优雅的代码</a></li><li><a href="/JavaScript/I-Dont-Know-JavaScript.html" class="sidebar-link">你看到的 JavaScript，并不是真实的</a></li></ul></div></li></ul></div><div class="page"><div class="content"><h1 id="ajax"><a href="#ajax" aria-hidden="true" class="header-anchor">#</a> AJAX</h1><p><code>AJAX</code> stands for <code>A</code>synchronous <code>J</code>avaScript and <code>X</code>ML. 它是使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest" target="_blank" rel="noopener noreferrer"><code>XMLHttpRequest</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>对象与服务器端脚本进行通信。它可以发送以及接收各种格式的信息，包括<code>JSON</code>，<code>XML</code>，<code>HTML</code>，甚至文本文件。</p><blockquote><p><code>XMLHttpRequest</code>是一个<code>API</code>, 它为客户端提供了在客户端和服务器之间传输数据的功能。它提供了一个通过<code>URL</code>来获取数据的简单方式，并且不会使整个页面刷新。<strong>这个对象充当着浏览器中的脚本（客户端）和服务器之间的中间人的角色</strong>。以往的请求都是由浏览器发出，而<code>JavaScript</code>通过这个对象可以自己发送请求，同时也自己处理响应。</p></blockquote><p>The two major features of <code>AJAX</code>:</p><ul><li>向服务器发出请求，而不重新加载页面</li><li>接收和处理服务器中的数据</li></ul><hr><h2 id="step-1-发出http请求"><a href="#step-1-发出http请求" aria-hidden="true" class="header-anchor">#</a> step 1 : 发出HTTP请求</h2><p>In order to make an <code>HTTP</code> request to the server using JavaScript, you need an <strong>instance</strong> of a class that provides this functionality.</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Old compatibility code, no longer needed.</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>XMLHttpRequest<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// Mozilla, Safari, IE7+ ...</span>
    httpRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>ActiveXObject<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// IE 6 and older</span>
    httpRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActiveXObject</span><span class="token punctuation">(</span><span class="token string">&quot;Microsoft.XMLHTTP&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// new</span>
<span class="token keyword">const</span> httpRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Next, you need to decide what you want to do after you receive the server response to your request. At this stage, you just need to tell the <code>HTTP</code> request object which JavaScript function will handle processing the response. This is done by setting the <code>onreadystatechange</code> property of the object to the name of the JavaScript function that should be called when the state of the request changes:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code>httpRequest<span class="token punctuation">.</span>onreadystatechange <span class="token operator">=</span> nameOfTheFunction<span class="token punctuation">;</span>
</code></pre></div><blockquote><p>注意，函数名后面没有括号，没有参数传递，因为你只是给函数赋了一个引用，而不是实际调用它。</p></blockquote><p>Also, instead of giving a function name, you can use the JavaScript technique of defining functions on the fly (called &quot;anonymous functions&quot;(匿名函数)) and define the actions that will process the response right away：</p><div class="language-javascript extra-class"><pre class="language-javascript"><code>httpRequest<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// process the server response</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p><code>onreadystatechange</code>是一个事件处理函数，它会在服务器给<code>XMLHttpRequest</code>对象送回响应的时候被触发。</p></blockquote><p>Next, after you've declared what will happen as soon as you receive the response, you need to actually make the request(一旦你确定了收到响应后会发生什么，这个时候你才能正式提出请求). You need to call the <code>open()</code> and <code>send()</code> methods of the HTTP request class:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code>httpRequest<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'http://www.example.org/some.file'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
httpRequest<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>我们最好始终将第三个参数设定成 <code>true</code> 以异步的方式发送请求的布尔值。另外强调的是，调用 <code>open()</code> 方法并不会真正发送请求，而只是启动一个请求以备发送，所以还需要调用 <code>send()</code>方法。</p></blockquote><p>如果不需要通过请求主体发送数据，则必须传入 null，比如使用 GET 方法。如果使用 POST 方法，需要将传送的数据加入。</p><h4 id="open"><a href="#open" aria-hidden="true" class="header-anchor">#</a> open()</h4><ul><li>The first parameter of <code>open()</code> is the HTTP request method – <code>GET</code>, <code>POST</code>, <code>HEAD</code> or any other method you want to use and that is supported by your server</li><li>The second parameter is the <code>URL</code> of the page you're requesting.</li><li>The <strong>optional</strong> third parameter sets whether the request is asynchronous. If TRUE (the default), the execution of the JavaScript function will continue while the response of the server has not yet arrived.</li></ul><h4 id="send"><a href="#send" aria-hidden="true" class="header-anchor">#</a> send()</h4><p>The parameter to the <code>send()</code> method can be any data you want to send to the server if <code>POST</code>-ing the request.</p><hr><h2 id="step-2-处理服务器请求"><a href="#step-2-处理服务器请求" aria-hidden="true" class="header-anchor">#</a> step 2 : 处理服务器请求</h2><p>When sending the request, you provided the name of a JavaScript function that is designed to handle the response.</p><div class="language-javascript extra-class"><pre class="language-javascript"><code>httpRequest<span class="token punctuation">.</span>onreadystatechange <span class="token operator">=</span> nameOfTheFunction<span class="token punctuation">;</span>
</code></pre></div><p>First, the function needs to check for the state of the request.</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>httpRequest<span class="token punctuation">.</span>readyState <span class="token operator">===</span> XMLHTTPRequest<span class="token punctuation">.</span><span class="token constant">DONE</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//everything is good, the response is received</span>
    <span class="token comment">// or httpRequest.readState === 4</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">//not ready</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The full list of the <code>readyState</code> values is as follows:</p><ul><li>0 表示未初始化。尚未调用 open() 方法</li><li>1 表示正在加载。已经调用 open() 方法，但未调用 send() 方法</li><li>2 表示加载完毕。已经调用 send() 方法，但尚未接收到响应</li><li>3 表示正在交互。已经接收到部分响应数据</li><li>4 表示完成。 已经接收到全部响应数据，而且可以在客户端使用了。</li></ul><blockquote><p>接收到响应后，响应的数据会自动填充 XMLHttpRequest 对象的属性</p></blockquote><ul><li>responseText: 作为响应主体被返回的文本</li><li>responseXML: 响应数据的内容类型是 &quot;text/xml&quot; 或 &quot;application/xml&quot;</li><li>status: 响应的 HTTP 状态</li><li>statusText: HTTP 状态的说明</li></ul><p>The next thing to check is the response code of the HTTP server response.</p><p>For example:</p><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>httpRequest<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// perfect!</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// there was a problem with the request,</span>
    <span class="token comment">// for example the response may contain a 404 (Not Found)</span>
    <span class="token comment">// or 500 (Internal Server Error) response code</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Now after you've checked the state of the request and the HTTP status code of the response, it's up to you to do whatever you want with the data the server has sent to you. You have two options to access that data(你有两种方式来获取数据):</p><ul><li><code>httpRequest.responseText</code> – returns the server response as a string of text</li><li><code>httpRequest.responseXML</code> – returns the response as an XMLDocument object you can traverse using the JavaScript DOM functions(这个属性用于保存<code>Content-Type</code>头部中指定为&quot;<code>text/xml</code>&quot;的数据，其实是一个<code>DocumentFragment</code>对象，可以用各种<code>DOM</code>方法来处理这个对象)</li></ul><hr><h2 id="使用数据"><a href="#使用数据" aria-hidden="true" class="header-anchor">#</a> 使用数据</h2><p>Finally, We can send some data to the server and receive a response.</p><hr><h2 id="取消异步请求"><a href="#取消异步请求" aria-hidden="true" class="header-anchor">#</a> 取消异步请求</h2><p>在接收到响应之前还可以调用 <code>abort()</code> 方法来取消异步请求。</p><div class="language-js extra-class"><pre class="language-js"><code>httpRequest<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><hr><h2 id="example"><a href="#example" aria-hidden="true" class="header-anchor">#</a> example</h2><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getNewContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">{</span>
        request<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;example.txt&quot;</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">var</span> para <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;p&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">var</span> txt <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
                para<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>txt<span class="token punctuation">)</span><span class="token punctuation">;</span>
                document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'new'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>para<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Sorry, your browser doesn\'t support XMLHttpRequest'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>回调函数中，通常我们只需通过 <code>readyState === 4</code> 判断请求是否完成。如果已完成，再根据 <code>status === 200</code> 判断是否是一个成功的响应。</p></blockquote><hr><h2 id="ajax-跨域"><a href="#ajax-跨域" aria-hidden="true" class="header-anchor">#</a> Ajax 跨域</h2><p>通过 XHR 实现 Ajax 通信的一个主要限制，来源于跨域安全策略。默认情况下，XHR 对象只能访问与包含它的页面位于同一个域中的资源。</p><p>CORS (Cross-Origin Resource Sharing, 跨域源资源共享) 是 W3C 的一个工作草案，定义了在必须访问跨域资源时，浏览器和服务器如何沟通。CORS 背后的思想是：<strong>使用自定义的 HTTP 头部让浏览器与服务器进行沟通，从而决定请求或响应是应该成功还是应该失败</strong>。</p><h3 id="简单请求"><a href="#简单请求" aria-hidden="true" class="header-anchor">#</a> 简单请求</h3><p>比如，在发送简单请求时，需要自定义一个 origin 头部，其中包含请求页面的源信息(协议、域名或端口)，以便服务器根据这个头部信息来决定是否给予响应。</p><div class="language-txt extra-class"><pre class="language-text"><code>Origin: http://xiaokedada.com
</code></pre></div><p>如果服务器认为这个请求可以接受，就在 Access-Control-Allow-Origin 头部中回发相同的源信息。</p><div class="language-txt extra-class"><pre class="language-text"><code>Access-Control-Allow-Origin: http://xiaokedada.com
</code></pre></div><p>如果没有这个头部，或者有这个头部但源信息不匹配，浏览器就会驳回请求。</p><p>IE 通过引入 XDR(XDomainRequest) 类型实现 CORS。其他浏览器对 CORS 的实现是<strong>使用标准的 XHR 对象并在 open() 方法中传入绝对 URL</strong>。</p><h3 id="非简单请求"><a href="#非简单请求" aria-hidden="true" class="header-anchor">#</a> 非简单请求</h3><p>CORS 通过一种叫做 Preflighted Requests 的透明服务器验证机制支持开发人员使用自定义的头部、GET 或 POST 之外的方法，以及不同类型的主体内容。这种请求使用 OPTIONS 方法，发送下列头部：</p><ul><li>Origin: 与简单请求一致</li><li>Access-Control-Request-Method: 请求自身使用的方法</li><li>Access-Control-Request-Headers: (可选) 自定义头部信息</li></ul><p>发送这个请求后，服务器可以决定是否允许这种类型的请求。在响应中发送如下头部与浏览器进行沟通。</p><ul><li>Access-Control-Allow-Origin: 与简单请求一致</li><li>Access-Control-Allow-Methods: 允许的方法</li><li>Access-Control-Allow-Headers: 允许的头部</li><li>Access-Control-Max-Age: 应该将这个 Preflight 请求缓存的时间(秒)</li></ul><p>强烈建议参考这篇文章: <a href="http://www.ruanyifeng.com/blog/2016/04/cors.html" target="_blank" rel="noopener noreferrer">跨域资源共享 CORS 详解<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><h3 id="jsonp-跨域技术"><a href="#jsonp-跨域技术" aria-hidden="true" class="header-anchor">#</a> JSONP 跨域技术</h3><p>JSONP (JSON with padding) 是<strong>应用</strong> JSON 的一种新方法，只是被包含在函数调用中的 JSON。</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;maoxiaoke&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>JSONP 是通过动态 <code>&lt;script&gt;</code> 元素来使用的，是因为 <code>&lt;script&gt;</code> 脚本具有跨域能力。下面这个栗子：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">handleResponse</span> <span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// do something</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span> <span class="token punctuation">(</span><span class="token string">&quot;script&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;http://xxx/json/？callback=handleResponse&quot;</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">insertBefore</span> <span class="token punctuation">(</span>script<span class="token punctuation">,</span> document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>参考: <a href="http://www.jianshu.com/p/82b82d5dd1ea" target="_blank" rel="noopener noreferrer">ajax跨域，这应该是最全的解决方案了<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote></div><div class="page-edit"><div class="edit-link"><a href="https://github.com/maoxiaoke/xiaokedada/edit/master/JavaScript/AJAX.md" target="_blank" rel="noopener noreferrer">在 Github 上编辑此页</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><div class="last-updated"><span class="prefix">上次更新: </span><span class="time">5/16/2018, 12:22:10 AM</span></div></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/JavaScript/Prototype.html" class="prev">
          再谈原型和继承
        </a></span><span class="next"><a href="/JavaScript/Coercion.html">
          强制类型转换
        </a> →
      </span></p></div></div></div></div>
    <script src="/assets/js/18.817df937.js" defer></script><script src="/assets/js/app.410137e2.js" defer></script>
  </body>
</html>
