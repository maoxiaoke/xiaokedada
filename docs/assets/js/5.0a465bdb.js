(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{211:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),a("p",[t._v("思考一个问题：Promise 适合什么、不适合什么？Promise 是万能的吗？")]),t._m(1),a("ol",[t._m(2),a("li",[a("a",{attrs:{href:"https://promisesaplus.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Promises/A+"),a("OutboundLink")],1)]),a("li",[a("a",{attrs:{href:"https://github.com/w3ctag/promises-guide",target:"_blank",rel:"noopener noreferrer"}},[t._v("w3ctag/promises-guide"),a("OutboundLink")],1)])]),t._m(3),a("p",[t._v("Promise 是抽象异步处理对象以及对其进行各种操作的组件。")]),t._m(4),a("p",[t._v("Node.js 中回调函数的一个例子：")]),t._m(5),a("p",[t._v("这是一种错误先行的策略。")]),a("p",[t._v("但是作者认为: 这个写法虽然很明了，但这仅仅是一个编码规约而已，即使采用其他的方法也不会出错。 而 Promise 则是把类似的异步处理对象和处理规则进行规范化，并按照采用统一的接口来编写，而采取规定方法之外的写法都会出错。")]),a("hr"),t._m(6),t._m(7),t._m(8),t._m(9),t._m(10),t._m(11),t._m(12),t._m(13),t._m(14),t._m(15),a("p",[t._v("promise chain 传递参数，例子：")]),t._m(16),t._m(17),t._m(18),t._m(19),t._m(20),t._m(21),t._m(22),t._m(23),t._m(24),t._m(25),t._m(26),a("p",[a("code",[t._v("Promise.resolve()")]),t._v(" 方法的另一个作用是将 "),a("a",{attrs:{href:"https://github.com/getify/You-Dont-Know-JS/blob/master/async%20%26%20performance/ch3.md#thenable-duck-typing",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("thenable")]),a("OutboundLink")],1),t._v(" 对象转换为 promise 对象。")]),t._m(27),a("p",[t._v("比如 "),a("a",{attrs:{href:"https://api.jquery.com/jQuery.ajax/",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("jQuery.ajax()")]),a("OutboundLink")],1),t._v(" 的返回值是 "),a("a",{attrs:{href:"http://api.jquery.com/jQuery.ajax/#jqXHR",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("jqXHR Object")]),a("OutboundLink")],1),t._v(" 对象，这个对象具有 "),a("code",[t._v(".then")]),t._v(" 方法。这个 "),a("code",[t._v("thenable")]),t._v(" 可以使用 "),a("code",[t._v("Promise.resolve()")]),t._v(" 来转换为一个 promise 对象。")]),t._m(28),t._m(29),t._m(30),t._m(31),t._m(32),t._m(33),t._m(34),t._m(35),t._m(36),t._m(37),a("hr"),t._m(38),t._m(39),t._m(40),t._m(41),t._m(42),t._m(43),t._m(44),a("p",[t._v("promise 对象刚被创建后的初始化状态")]),t._m(45),a("p",[t._v("对于状态的解释主要有以下几点：")]),t._m(46),a("hr"),t._m(47),t._m(48),t._m(49),t._m(50),t._m(51),a("p",[t._v("上面这个函数，根据 DOM 是否装载完毕来决定是否对回调函数进行同步还是异步调用，这就造成同步异步产生混乱的问题。")]),t._m(52),t._m(53),a("hr"),t._m(54),t._m(55),t._m(56),a("p",[t._v("所以，对于错误处理，我们可以采用两种方式：")]),t._m(57),a("p",[t._v("下面是两者的异同：")]),t._m(58),t._m(59),t._m(60),t._m(61),a("p",[t._v("下面都是"),a("a",{attrs:{href:"https://github.com/maoxiaoke",target:"_blank",rel:"noopener noreferrer"}},[t._v("我"),a("OutboundLink")],1),t._v(" 加的内容。")]),t._m(62),a("p",[t._v("比如下面的这个函数：")]),t._m(63),t._m(64),a("p",[t._v("在标识一个 Promise 时，通常是一个这样的方式：")]),t._m(65),t._m(66),a("p",[t._v("对于很多类似的问题，都可以采用这种思考方式。")]),t._m(67),t._m(68),t._m(69),t._m(70),a("p",[t._v("执行顺序是，就算 Catch 1 捕获到 Task 1 的错误，Task 2 仍然执行。Catch 2 只能捕获 Task 2 的错误；Task 1 的错误由 Catch 1 捕获。")]),t._m(71),t._m(72),a("p",[t._v("比如，有一批挨个处理的数据，当其顺序执行到最后一个都返回 Fulfilled 时，执行成功；其中有一个返回 Rejected 时， 执行失败。")]),t._m(73),t._m(74),t._m(75),t._m(76),a("p",[t._v("我们还可以思考一下变种：")]),t._m(77),t._m(78),t._m(79),a("p",[t._v("如果你对"),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop",target:"_blank",rel:"noopener noreferrer"}},[t._v("轮询机制"),a("OutboundLink")],1),t._v(" 比较了解的话，最终的结果应该是最后完成的 resolve 或 reject。")]),a("p",[t._v("对于上述的变种，如下：")]),t._m(80),t._m(81),t._m(82),t._m(83),a("p",[t._v("但两者表达试图表达的含义并非一致。")]),t._m(84),t._m(85),t._m(86),t._m(87),t._m(88),t._m(89),t._m(90),t._m(91),t._m(92),t._m(93),t._m(94),t._m(95),a("p",[t._v("如何？？？")]),a("p",[t._v("文章有参考：")]),a("ul",[a("li",[a("a",{attrs:{href:"https://css-tricks.com/why-using-reduce-to-sequentially-resolve-promises-works/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Why Using reduce() to Sequentially Resolve Promises Works"),a("OutboundLink")],1)]),a("li",[a("a",{attrs:{href:"https://decembersoft.com/posts/promises-in-serial-with-array-reduce/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Back to Basics: Running Promises in Serial with Array.reduce()"),a("OutboundLink")],1)]),a("li",[a("a",{attrs:{href:"https://github.com/yoshuawuyts/promise-reduce/blob/master/index.js#L21:42",target:"_blank",rel:"noopener noreferrer"}},[t._v("promise-reduce的一个库"),a("OutboundLink")],1)])]),a("p",[t._v("TODO:")]),t._m(96)])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"javascript-promise-迷你书（中译本）"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#javascript-promise-迷你书（中译本）","aria-hidden":"true"}},[this._v("#")]),this._v(" JavaScript Promise 迷你书（中译本）")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"规范中心"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#规范中心","aria-hidden":"true"}},[this._v("#")]),this._v(" 规范中心")])},function(){var t=this.$createElement,s=this._self._c||t;return s("li",[s("a",{attrs:{href:""}},[this._v("ECMAScript 6 Promises")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"什么是-promise"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是-promise","aria-hidden":"true"}},[this._v("#")]),this._v(" 什么是 Promise")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Promise 最初被提出是 "),s("code",[this._v("E")]),this._v(" 语言。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token function"}},[t._v("getAsync")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'fileA'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" result"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" error\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// Do something")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"promise-api"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#promise-api","aria-hidden":"true"}},[this._v("#")]),this._v(" Promise API")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"constructor-实例化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#constructor-实例化","aria-hidden":"true"}},[this._v("#")]),this._v(" Constructor - 实例化")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" promise "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("Promise")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resolve"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reject"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 异步处理")]),t._v("\n  "),a("span",{attrs:{class:"token comment"}},[t._v("// 处理结束后调用 resolve 或 reject")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"instance-method"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#instance-method","aria-hidden":"true"}},[this._v("#")]),this._v(" Instance Method")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"then"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#then","aria-hidden":"true"}},[this._v("#")]),this._v(" then()")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("promise"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("then")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("onFulfilled"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" onRejected"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("resolve")]),this._v("(成功)时：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("回调函数 "),s("code",[this._v("onFulfilled")]),this._v(" 会被调用")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("reject")]),this._v("(失败时)：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("回调函数 "),s("code",[this._v("onRejected")]),this._v(" 会被调用")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" promise "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Promise"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\npromise\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("then")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("val "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" val "),a("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("then")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("val "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" val "),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("2")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("then")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("val "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("val"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("catch")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("return")]),this._v(" 的值可以是字符串或者数值类型，对象或者 promise。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[s("code",[this._v("return")]),this._v(" 的值会由 "),s("code",[this._v("Promise.resolve(返回值)")]),this._v(" 进行一层包装处理，因此不管回调函数中会返回一个什么样的值，最终 then 的结果都是返回一个新创建的 promise 对象。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"catch"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#catch","aria-hidden":"true"}},[this._v("#")]),this._v(" catch()")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("catch()")]),this._v(" 方法只是 "),s("code",[this._v("promise.then(undefined, onRejected)")]),this._v(" 的一个别名而已。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"warning custom-block"},[s("p",{staticClass:"custom-block-title"},[this._v("WARNING")]),s("p",[s("strong",[this._v("每次调用 "),s("code",[this._v("then")]),this._v(" 和 "),s("code",[this._v("catch")]),this._v(" 都会返回一个新创建的 promise 对象")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"static-method"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#static-method","aria-hidden":"true"}},[this._v("#")]),this._v(" Static Method")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"promise-resolve"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#promise-resolve","aria-hidden":"true"}},[this._v("#")]),this._v(" Promise.resolve()")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("一般情况下我们可以使用 new Promise() 来创建 promise 对象，还可以使用 "),s("code",[this._v("Promise.resolve()")]),this._v(" 和 "),s("code",[this._v("Promise.reject()")]),this._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("比如： "),s("code",[this._v("Promise.resolve(42)")]),this._v("，可以认为是以下代码的语法糖：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("Promise")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resolve"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" rejecte"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token function"}},[t._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("42")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("这种将 thenable 对象转换为 promise 对象的机制要求 thenable 对象所拥有的 then 方法应该和 promise 所拥有的 then 方法具有同样的功能和处理过程。")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" promise "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Promise"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("ajax")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'/json/comment.json'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("应当注意的是，即使有一个对象具有 "),s("code",[this._v("then")]),this._v(" 方法，也不一定就能作为 Promises 对象使用。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[this._v("TIP")]),s("p",[this._v("简单总结一下的话，可以认为它的作用就是将传递给它的参数 Fulfilled 到 promise 对象后并返回这个 promise 对象。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"promise-reject"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#promise-reject","aria-hidden":"true"}},[this._v("#")]),this._v(" Promise.reject()")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("Promise.reject()")]),this._v(" 正好是 "),s("code",[this._v("Promise.resolve()")]),this._v(" 的对立。在编写测试代码或者进行 debug 的时候，也许用得上。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"promise-all"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#promise-all","aria-hidden":"true"}},[this._v("#")]),this._v(" Promise.all()")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("Promise.all")]),this._v(" 接收一个 promise 对象的数组作为参数，当这个数组里所有 promise 对象全部变为 Fulfilled 或 Rejected 状态的时候，它才会调用 "),s("code",[this._v(".then")]),this._v(" 方法。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"promise-race"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#promise-race","aria-hidden":"true"}},[this._v("#")]),this._v(" Promise.race()")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("与 "),s("code",[this._v("Promise.all")]),this._v(" 相对的是，"),s("code",[this._v("Promise.race")]),this._v(" Fulfilled 或 Rejected，才会进行后面的处理。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"warning custom-block"},[s("p",{staticClass:"custom-block-title"},[this._v("WARNING")]),s("p",[this._v("需要注意的是，"),s("code",[this._v("Promise.race")]),this._v(" 在第一个 promise 对象变成 Fulfilled 时候，并不会取消其他 promise 对象的执行。理解起来也很简单，当 promise 的状态从 Pending 开始转化时，最终会进入 Fulfilled 或 Rejected 的状态之一。")]),s("p",[this._v("所以得到 Promise 一个不适用的场景：不适用于状态可能会固定不变的处理。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"promise-的状态"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#promise-的状态","aria-hidden":"true"}},[this._v("#")]),this._v(" Promise 的状态")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("用 "),s("code",[this._v("new Promise")]),this._v(" 实例化的 "),s("code",[this._v("promise")]),this._v(" 对象有以下三个状态：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v('"has-resolution" - Fulfilled')])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("完成状态，此时会调用 "),s("code",[this._v("onFulfilled")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v('"has-rejection" - Rejected')])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("拒绝状态，此时会调用 "),s("code",[this._v("onRejected")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v('"unresolved" - Pending')])])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("左侧是 ES6 Promises 规范中的术语，右侧则是 Promises/A+ 中描述状态的术语")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("promise 对象的状态，从 Pending 装换为 Fullfilled 或 Rejected 对象的状态之后就不会再发生变化 - "),s("strong",[this._v("完成即不变")])]),s("li",[this._v("由于第一点，所以 "),s("code",[this._v("then()")]),this._v(" 后执行的函数可以肯定地说只会被调用一次")]),s("li",[this._v("Fulfilled 和 Rejected 这两个中的任一状态都可以表示 Settled。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"promise-的异步性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#promise-的异步性","aria-hidden":"true"}},[this._v("#")]),this._v(" Promise 的异步性")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("then")]),this._v(" 中指定的方法调用都是异步进行的。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("可能存有疑惑的时，当 "),s("code",[this._v("Promise.resove(value)")]),this._v(" 等方法解析“立即值”的时，"),s("code",[this._v("Promise")]),this._v(" 对象能立即进入 Fullfilled 状态或 Rejected 状态，那为啥 "),s("code",[this._v("then")]),this._v(" 里指定的方法不是同步调用的呢？")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("这其实是 "),s("code",[this._v("Promise")]),this._v(" 的一个设计规范 - 解决异步同步调用同时存在所产生的混乱问题。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("onReady")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fn"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" readyState "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("readyState"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("readyState "),a("span",{attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'interactive'")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("||")]),t._v(" readyState "),a("span",{attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'complete'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token function"}},[t._v("fn")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    window"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'DOMContentLoaded'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fn"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("onReady")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'DOM fully loaded and parsed'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'==Starting=='")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("为此，我们可以采用 "),s("code",[this._v("setTimeout(fn(), 0)")]),this._v(" 进行 "),s("strong",[this._v("同步异步化")]),this._v("。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("onReady")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fn"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" readyState "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("readyState"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("readyState "),a("span",{attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'interactive'")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("||")]),t._v(" readyState "),a("span",{attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'complete'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token function"}},[t._v("fn")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("0")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    window"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("addEventListener")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'DOMContentLoaded'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fn"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("onReady")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'DOM fully loaded and parsed'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nconsole"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'==Starting=='")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"then-或-catch"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#then-或-catch","aria-hidden":"true"}},[this._v("#")]),this._v(" then 或 catch")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在"),s("a",{attrs:{href:"#catch()"}},[this._v("前面")]),this._v("我们提到过：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[s("code",[this._v("catch()")]),this._v(" 方法只是 "),s("code",[this._v("promise.then(undefined, onRejected)")]),this._v(" 的一个别名而已。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[s("code",[this._v("promise.then(onFulfilled, onRejected)")]),this._v(" 指定对错误函数的处理")]),s("li",[this._v("使用 "),s("code",[this._v("promise.catch()")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("throwError")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("val"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("Error")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("val"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// then 方式")]),t._v("\nPromise"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("42")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("then")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("throwError"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'then 方式'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// error: Uncaught (in promise) Error: 42 at throwError (<anonymous>:2:9)")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// catch 方式")]),t._v("\nPromise"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("42")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("then")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("throwError"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("catch")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'catch 方式'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 'catch 方式'")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("也就是说，当使用 "),s("code",[this._v("then")]),this._v("方式 捕获错误的时候，"),s("strong",[this._v("实际上不能捕获第一个参数 "),s("code",[this._v("onFulfilled")]),this._v(" 指定的函数")]),this._v("，它针对的是自身的 promise 对象或者之前的 promise 对象。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("而 "),s("code",[this._v("catch")]),this._v(" 方式，则遵循了 "),s("code",[this._v("throwError")]),this._v(" -> "),s("code",[this._v("onRejected")]),this._v(" 的方式。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("所以，"),s("code",[this._v("catch")]),this._v(" 方式是最佳实践。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"返回-promise-的函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#返回-promise-的函数","aria-hidden":"true"}},[this._v("#")]),this._v(" 返回 Promise 的函数")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("aPromise")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" Promise"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("then")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("                      "),a("span",{attrs:{class:"token comment"}},[t._v("// Task 1")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("2")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("catch")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("error")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   "),a("span",{attrs:{class:"token comment"}},[t._v("// Catch 2")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" bPromise "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("aPromise")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token function"}},[t._v("aPromise")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("then")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("catch")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("error")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("message"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[a("code",[t._v("aPromise()")]),t._v(" 返回的一个 Promise，对于 "),a("code",[t._v("bPromise")]),t._v(" 而言，是函数 "),a("code",[t._v("aPromise()")]),t._v(" 最终的 "),a("code",[t._v("resolve")]),t._v(" 或 "),a("code",[t._v("reject")]),t._v(" 的值(即 Task 1 的完成值)。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v('[[PromiseStatus]]: "resolved"\n[[PromiseValue]]: undefined\n')])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("即两个内部属性 "),a("code",[t._v("[PromiseStatus]]")]),t._v(" 和 "),a("code",[t._v("[[PromiseValue]]")]),t._v("。对于每个 Promise 的分析都可以采用这样的结构方式。上例的 "),a("code",[t._v("bPromise")]),t._v(" 的 "),a("code",[t._v("[[PromiseStatus]]")]),t._v(" 应该是 "),a("code",[t._v('"resolved"')]),t._v("，而 "),a("code",[t._v("[[PromiseValue]]")]),t._v(" 是 "),a("code",[t._v("2")]),t._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"catch-之后的-then"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#catch-之后的-then","aria-hidden":"true"}},[this._v("#")]),this._v(" catch() 之后的 then()")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("一般来说，我们将 "),s("code",[this._v("catch()")]),this._v(" 放在 "),s("code",[this._v("then()")]),this._v(" 链的最后，以便 "),s("em",[this._v("捕获链上的任何错误")]),this._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("但是仍可以有 "),s("code",[this._v("then().catch().then().catch()")]),this._v(" 这样的链方式。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("aPromise")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" Promise"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("then")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'error'")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("                        "),a("span",{attrs:{class:"token comment"}},[t._v("// Task 1")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("catch")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("error")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// Catch 1")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("then")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Promise"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("2")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),a("span",{attrs:{class:"token comment"}},[t._v("// Task 2")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("catch")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("error")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),a("span",{attrs:{class:"token comment"}},[t._v("// Catch 2")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"使用-reduce-顺序执行-promise"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-reduce-顺序执行-promise","aria-hidden":"true"}},[this._v("#")]),this._v(" 使用 reduce() 顺序执行 promise")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("Array.prototype.reduce()")]),this._v(" 是一个非常函数化的方法，其语义化为：通过在循环时将结果存储在累加器(accumulator)中，从而把一堆东西减少(reduce)为一个。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" tasks "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{attrs:{class:"token number"}},[t._v("2")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{attrs:{class:"token number"}},[t._v("3")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("methodThatReturnsAPromise")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" Promise"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\ntasks"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("reduce")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("previousPromise"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nextID"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" previousPromise"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("then")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("methodThatReturnsAPromise")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextID"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Promise"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("倘若使用 "),s("code",[this._v("async/await")]),this._v(" 语法。可以更为直接一点：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" tasks "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{attrs:{class:"token number"}},[t._v("2")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{attrs:{class:"token number"}},[t._v("3")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\ntasks"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("reduce")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("previousPromise"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nextID"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("await")]),t._v(" previousPromise\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("methodThatReturnsAPromise")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextID"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Promise"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"warning custom-block"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),a("p",[t._v("相较于 "),a("code",[t._v("Promise.all([ task1, task2, task3 ])")]),t._v("，两者是有区别的。")]),a("ul",[a("li",[t._v("其一，"),a("code",[t._v("Promise.all([ task1, task2, task3 ])")]),t._v(" 是同时开始，并行执行的。而采用 "),a("code",[t._v("reduce()")]),t._v(" 方法的是顺序执行的。")]),a("li",[t._v("其二，"),a("code",[t._v("Promise.all([ task1, task2, task3 ])")]),t._v(" 适合 tasks 长度短且 task 不相似的情况。")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" tasks "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{attrs:{class:"token number"}},[t._v("2")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{attrs:{class:"token number"}},[t._v("3")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" promise "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Promise"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" nextID "),a("span",{attrs:{class:"token keyword"}},[t._v("of")]),t._v(" tasks"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  promise "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" promise"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("then")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("methodThatReturnsAPromise")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextID"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("实际上这种方式并不能达到我们的要求，因为 "),s("code",[this._v("for...in")]),this._v(" 总是同步进行的。实际上上述代码的运行情况如下：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" tasks "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{attrs:{class:"token number"}},[t._v("2")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{attrs:{class:"token number"}},[t._v("3")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" promise "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Promise"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// loop 1")]),t._v("\npromise "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" promise"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("then")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("methodThatReturnsAPromise")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// loop 2")]),t._v("\npromise "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" promise"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("then")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("methodThatReturnsAPromise")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("2")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// loop 3")]),t._v("\npromise "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" promise"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("then")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("methodThatReturnsAPromise")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("3")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("handleSequencePromise")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" nextID "),a("span",{attrs:{class:"token keyword"}},[t._v("of")]),t._v(" tasks"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("promiseReturningMethod")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextID"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"new-promise-reslove-和-promise-reslove-的区别"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#new-promise-reslove-和-promise-reslove-的区别","aria-hidden":"true"}},[this._v("#")]),this._v(" new Promise (reslove) 和 Promise.reslove() 的区别")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("正如在上面提到的。我们可以认为 "),s("code",[this._v("Promise.resolve(42)")]),this._v("，是下列代码的语法糖：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("Promise")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resolve"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reject"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token function"}},[t._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("42")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("Promise.resolve()")]),this._v(" 创建的是一个已经 resolved 的 promise，而 "),s("code",[this._v("new Promise(resolve)")]),this._v(" 除了可以创建已经 resolved 或 rejected 的 promise (如果是这类情况，实际上跟 Promise.resolve() 和 Promise.reject() 的表现并无二致)，还可以创建处于 Pending 状态的 promise (这一点才是 new Promise(reslove) 真正发挥实力的地方)。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("下面的例子中，会使用 "),s("code",[this._v("setTimeout()")]),this._v(" 来模拟一个异步函数。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("delay")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ms"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("Promise")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resolve "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'DONE'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ms"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" x "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("delay")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("10000")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v('/*\n在 10s 之前， `x` 的状态为：\n[[PromiseStatus]]: "pending"\n[[PromiseValue]]: undefined\n\n10s 之后，`x` 的状态为：\n[[PromiseStatus]]: "resolved"\n[[PromiseValue]]: "DONE"\n*/')]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"promise-和差错控制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#promise-和差错控制","aria-hidden":"true"}},[this._v("#")]),this._v(" Promise 和差错控制")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"基于-promise-的函数不该-throw-异常"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基于-promise-的函数不该-throw-异常","aria-hidden":"true"}},[this._v("#")]),this._v(" 基于 Promise 的函数不该 throw 异常")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("我们知道，"),s("code",[this._v("throw")]),this._v(" 是 JavaScript 主动抛出异常的一种方式。比如，我们用在 Promise 当中：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("// 使用 `throw` 抛出错误")]),t._v("\nPromise"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("then")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("Error")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'error'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("catch")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v('// "error"')]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 使用 reject 方式")]),t._v("\nPromise"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("then")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  Promise"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("reject")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'error'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("catch")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e "),a("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" console"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("log")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v('// "error"')]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("看上去两者似乎表现一致，但 "),a("code",[t._v("throw")]),t._v(" 是"),a("strong",[t._v("同步")]),t._v("抛出错误，最终被 catch 捕获；而 "),a("code",[t._v("reject")]),t._v(" 是将该 Promise 的 "),a("code",[t._v("[[PromiseStatus]]")]),t._v(" 置为 "),a("code",[t._v("rejected")]),t._v("，是一种异步行为。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("为什么用 "),s("code",[this._v("reject")]),this._v(" 而不是 "),s("code",[this._v("throw")]),this._v(" ?")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"resolve-是什么"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#resolve-是什么","aria-hidden":"true"}},[this._v("#")]),this._v(" resolve 是什么")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"promise-结合-settimeout"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#promise-结合-settimeout","aria-hidden":"true"}},[this._v("#")]),this._v(" Promise 结合 setTimeout()")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"返回-promise-链的函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#返回-promise-链的函数","aria-hidden":"true"}},[this._v("#")]),this._v(" 返回 Promise 链的函数")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("[] Difference between returning a promise vs returning undefined inside a promise")]),s("li",[this._v("[] JavaScript Promises - reject vs. throw")]),s("li",[this._v("[] new Promise 没有 return，却有返回")]),s("li",[this._v("[] try...catch/ 差错控制")])])}],!1,null,null,null);s.default=e.exports}}]);