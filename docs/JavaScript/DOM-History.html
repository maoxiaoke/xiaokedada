<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>和 URL 相关的 Location 和 History | XIAOKEDADA</title>
    <meta name="description" content="Write something useful and funny">
    <link rel="icon" href="/favicon.png">
    
    <link rel="preload" href="/assets/css/68.styles.d3eb3505.css" as="style"><link rel="preload" href="/assets/js/app.843b634b.js" as="script"><link rel="preload" href="/assets/js/37.21574b04.js" as="script"><link rel="prefetch" href="/assets/js/35.fc0649b6.js"><link rel="prefetch" href="/assets/js/1.85421567.js"><link rel="prefetch" href="/assets/js/2.f423fd68.js"><link rel="prefetch" href="/assets/js/3.1f142fb1.js"><link rel="prefetch" href="/assets/js/4.bd68aee8.js"><link rel="prefetch" href="/assets/js/5.0a465bdb.js"><link rel="prefetch" href="/assets/js/6.97e629f1.js"><link rel="prefetch" href="/assets/js/7.bb19bdef.js"><link rel="prefetch" href="/assets/js/8.5daef4ca.js"><link rel="prefetch" href="/assets/js/9.4fcb0f34.js"><link rel="prefetch" href="/assets/js/10.4376478b.js"><link rel="prefetch" href="/assets/js/11.8fc6b13a.js"><link rel="prefetch" href="/assets/js/12.1772ec65.js"><link rel="prefetch" href="/assets/js/13.a4ef0e77.js"><link rel="prefetch" href="/assets/js/14.427f03c9.js"><link rel="prefetch" href="/assets/js/15.723a7d06.js"><link rel="prefetch" href="/assets/js/16.166d836c.js"><link rel="prefetch" href="/assets/js/17.21b4f630.js"><link rel="prefetch" href="/assets/js/18.fd756ec4.js"><link rel="prefetch" href="/assets/js/19.a8b80d16.js"><link rel="prefetch" href="/assets/js/20.8e9cdb67.js"><link rel="prefetch" href="/assets/js/21.4e4f2b91.js"><link rel="prefetch" href="/assets/js/22.d28267a3.js"><link rel="prefetch" href="/assets/js/23.653fa423.js"><link rel="prefetch" href="/assets/js/24.8ed99de7.js"><link rel="prefetch" href="/assets/js/25.614045fd.js"><link rel="prefetch" href="/assets/js/26.02791f7a.js"><link rel="prefetch" href="/assets/js/27.3fa3f1e9.js"><link rel="prefetch" href="/assets/js/28.8aaaacba.js"><link rel="prefetch" href="/assets/js/29.02e1b211.js"><link rel="prefetch" href="/assets/js/30.46e3e02b.js"><link rel="prefetch" href="/assets/js/31.8af56ad3.js"><link rel="prefetch" href="/assets/js/32.091d8ef1.js"><link rel="prefetch" href="/assets/js/33.d33fb871.js"><link rel="prefetch" href="/assets/js/34.d41761e9.js"><link rel="prefetch" href="/assets/js/0.e6be7c2e.js"><link rel="prefetch" href="/assets/js/36.d0053b92.js"><link rel="prefetch" href="/assets/js/38.80e207ae.js"><link rel="prefetch" href="/assets/js/39.e4995ccf.js"><link rel="prefetch" href="/assets/js/40.5d361e67.js"><link rel="prefetch" href="/assets/js/41.a50cd60b.js"><link rel="prefetch" href="/assets/js/42.caf66f0e.js"><link rel="prefetch" href="/assets/js/43.4a9eaf80.js"><link rel="prefetch" href="/assets/js/44.448792e0.js"><link rel="prefetch" href="/assets/js/45.a2c7b618.js"><link rel="prefetch" href="/assets/js/46.d5711dfe.js"><link rel="prefetch" href="/assets/js/47.b7c59a32.js"><link rel="prefetch" href="/assets/js/48.d54390f0.js"><link rel="prefetch" href="/assets/js/49.0e14e323.js"><link rel="prefetch" href="/assets/js/50.116c6f8c.js"><link rel="prefetch" href="/assets/js/51.00a2e7ea.js"><link rel="prefetch" href="/assets/js/52.96b8f0e2.js"><link rel="prefetch" href="/assets/js/53.6316d91b.js"><link rel="prefetch" href="/assets/js/54.3120e195.js"><link rel="prefetch" href="/assets/js/55.7582a732.js"><link rel="prefetch" href="/assets/js/56.eab8bc2a.js"><link rel="prefetch" href="/assets/js/57.74edb44a.js"><link rel="prefetch" href="/assets/js/58.5122e2dc.js"><link rel="prefetch" href="/assets/js/59.3ec0162a.js"><link rel="prefetch" href="/assets/js/60.8ec70531.js"><link rel="prefetch" href="/assets/js/61.fc7a010b.js"><link rel="prefetch" href="/assets/js/62.e17877aa.js"><link rel="prefetch" href="/assets/js/63.44b0382a.js"><link rel="prefetch" href="/assets/js/64.621d7404.js"><link rel="prefetch" href="/assets/js/65.755ec884.js"><link rel="prefetch" href="/assets/js/66.bfb5a72d.js"><link rel="prefetch" href="/assets/js/67.b71bf6f3.js">
    <link rel="stylesheet" href="/assets/css/68.styles.d3eb3505.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      XIAOKEDADA
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/JavaScript/" class="nav-link router-link-active">JavaScript</a></div><div class="nav-item"><a href="/FirstMeet/" class="nav-link">FirstMeet系列</a></div><div class="nav-item"><a href="/CSS/" class="nav-link">CSS</a></div><div class="nav-item"><a href="/ReadingNote/" class="nav-link">读书笔记</a></div><div class="nav-item"><a href="/GatherAll/" class="nav-link">R &amp; T</a></div><a href="https://github.com/maoxiaoke/xiaokedada" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/JavaScript/" class="nav-link router-link-active">JavaScript</a></div><div class="nav-item"><a href="/FirstMeet/" class="nav-link">FirstMeet系列</a></div><div class="nav-item"><a href="/CSS/" class="nav-link">CSS</a></div><div class="nav-item"><a href="/ReadingNote/" class="nav-link">读书笔记</a></div><div class="nav-item"><a href="/GatherAll/" class="nav-link">R &amp; T</a></div><a href="https://github.com/maoxiaoke/xiaokedada" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>Depth-in-Series</span><!----></p><ul class="sidebar-group-items"><li><a href="/JavaScript/Require-and-Import.html" class="sidebar-link">require 和 import 的难点</a></li><li><a href="/JavaScript/Property-Descriptors.html" class="sidebar-link">JavaScript 对象的 Property descriptors</a></li><li><a href="/JavaScript/Depth-in-ES6.html" class="sidebar-link">深入理解 ES6</a></li><li><a href="/JavaScript/Depth-in-This.html" class="sidebar-link">this 的挑战</a></li><li><a href="/JavaScript/Depth-in-Closure.html" class="sidebar-link">来一次痛痛快快得闭包挑战</a></li><li><a href="/JavaScript/Async-Programming.html" class="sidebar-link">JavaScript 异步编程</a></li><li><a href="/JavaScript/Prototype.html" class="sidebar-link">再谈原型和继承</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Re-learn ES6</span><!----></p><ul class="sidebar-group-items"><li><a href="/JavaScript/ES6-Let-and-Const.html" class="sidebar-link">最佳实践，使用 let/const</a></li><li><a href="/JavaScript/ES6-Class.html" class="sidebar-link">近似 Class 的操作</a></li><li><a href="/JavaScript/ES6-Symbols.html" class="sidebar-link">万物皆不同 - Symbols</a></li><li><a href="/JavaScript/ES6-Iterator-And-Iterable.html" class="sidebar-link">迭代协议</a></li><li><a href="/JavaScript/ES6-Async.html" class="sidebar-link">异步编程要点</a></li><li><a href="/JavaScript/ES6-Generator.html" class="sidebar-link">Generator</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Light FP</span><!----></p><ul class="sidebar-group-items"><li><a href="/JavaScript/Light-FP-Overview.html" class="sidebar-link">Light-FP 概念篇</a></li><li><a href="/JavaScript/Light-FP-Categries.html" class="sidebar-link">范畴学基础理论</a></li><li><a href="/JavaScript/Light-FP-Compose.html" class="sidebar-link">Compose</a></li><li><a href="/JavaScript/Light-FP-Container-And-Functor.html" class="sidebar-link">Container and Functor</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>基础内容</span><!----></p><ul class="sidebar-group-items"><li><a href="/JavaScript/AJAX.html" class="sidebar-link">AJAX</a></li><li><a href="/JavaScript/Coercion.html" class="sidebar-link">强制类型转换</a></li><li><a href="/JavaScript/Map-and-Reduce.html" class="sidebar-link">JavaScript 的 map/reduce</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>DOM 相关</span><!----></p><ul class="sidebar-group-items"><li><a href="/JavaScript/DOM-Operation.html" class="sidebar-link">原生JavaScript的DOM操作</a></li><li><a href="/JavaScript/DOM-More.html" class="sidebar-link">再来仔细研究DOM</a></li><li><a href="/JavaScript/DOM-History.html" class="active sidebar-link">和 URL 相关的 Location 和 History</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/JavaScript/DOM-History.html#url" class="sidebar-link">URL</a></li><li class="sidebar-sub-header"><a href="/JavaScript/DOM-History.html#location-interface" class="sidebar-link">Location Interface</a></li><li class="sidebar-sub-header"><a href="/JavaScript/DOM-History.html#history-interface" class="sidebar-link">History Interface</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/JavaScript/DOM-History.html#popstate-事件" class="sidebar-link">popstate 事件</a></li><li class="sidebar-sub-header"><a href="/JavaScript/DOM-History.html#state" class="sidebar-link">state</a></li></ul></li><li class="sidebar-sub-header"><a href="/JavaScript/DOM-History.html#history-pushstate-history-replacestate" class="sidebar-link">history.pushState()/history.replaceState()</a></li><li class="sidebar-sub-header"><a href="/JavaScript/DOM-History.html#hash-和-history-实现前端路由" class="sidebar-link">hash 和 history 实现前端路由</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/JavaScript/DOM-History.html#location-hash" class="sidebar-link">location.hash</a></li><li class="sidebar-sub-header"><a href="/JavaScript/DOM-History.html#history" class="sidebar-link">history</a></li></ul></li><li class="sidebar-sub-header"><a href="/JavaScript/DOM-History.html#参考" class="sidebar-link">参考</a></li></ul></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Thinking-in-JavaScript</span><!----></p><ul class="sidebar-group-items"><li><a href="/JavaScript/Small-and-Chunk-Code.html" class="sidebar-link">书写有用而优雅的代码</a></li><li><a href="/JavaScript/I-Dont-Know-JavaScript.html" class="sidebar-link">你看到的 JavaScript，并不是真实的</a></li><li><a href="/JavaScript/Refactor-JavaScript.html" class="sidebar-link">有关代码重构和整洁之道</a></li><li><a href="/JavaScript/JavaScript-Design-Pattern.html" class="sidebar-link">设计模式</a></li></ul></div></li></ul></div><div class="page"><div class="content"><h1 id="和-url-相关的-location-和-history"><a href="#和-url-相关的-location-和-history" aria-hidden="true" class="header-anchor">#</a> 和 URL 相关的 Location 和 History</h1><p>对路由这一块，相对来说接触的比较少。正好碰到了一个页面跳转的问题，就顺便把自己想了解的笼络了一下。</p><h2 id="url"><a href="#url" aria-hidden="true" class="header-anchor">#</a> URL</h2><p>URL 是 URI 的一个子集，具体区别参考<a href="https://stackoverflow.com/questions/176264/what-is-the-difference-between-a-uri-a-url-and-a-urn" target="_blank" rel="noopener noreferrer">What is the difference between a URI, a URL and a URN?<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p><p>这里了解一下 URI 的一般语法：</p><div class="language-text extra-class"><pre class="language-text"><code>URI = scheme:[//authority]path[?query][#fragment]

其中：

authority = [userinfo@]host[:port]
</code></pre></div><p>框图如下：</p><p><img src="https://upload.wikimedia.org/wikipedia/commons/9/96/URI_syntax_diagram.png" alt></p><p>其中，<code>path</code>、<code>query</code> 和 <code>fragment</code> 值得我们思考。其中 <code>fragment</code> 前面有个 <code>#</code>(hash)。</p><h2 id="location-interface"><a href="#location-interface" aria-hidden="true" class="header-anchor">#</a> Location Interface</h2><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Location#Specifications" target="_blank" rel="noopener noreferrer">Location<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是，就能获取到 URI 上的所有信息。</p><p>比如：<code>https://developer.mozilla.org/en-US/docs/Web/API/Location#Specifications</code>，在控制台打印的结果：</p><p><img src="http://p3puylt4n.bkt.clouddn.com/location.jpg" alt></p><h2 id="history-interface"><a href="#history-interface" aria-hidden="true" class="header-anchor">#</a> History Interface</h2><p>阅读前，请翻阅官方文档：<a href="https://www.w3.org/TR/html50/browsers.html#the-history-interface" target="_blank" rel="noopener noreferrer">History Interface<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p>History 是用来处理操纵用户浏览记录的 API。这个 API 因为也常用于页面的跳转，所以和 url 还是有一定联系的。</p><p><img src="http://p3puylt4n.bkt.clouddn.com/history.jpg" alt></p><p>对于浏览器的实现上，应该是是一个 <strong>栈</strong>(Stack) 的结构。</p><p>对于这个 API，需要着重强调的是 <code>pushState()</code> 和 <code>replaceState()</code> 这两个方法。然而，这两个方法又和 <code>popstate</code> 事件息息相关。</p><h3 id="popstate-事件"><a href="#popstate-事件" aria-hidden="true" class="header-anchor">#</a> popstate 事件</h3><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowEventHandlers/onpopstate" target="_blank" rel="noopener noreferrer">MDN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 上提供的 popstate 事件触发条件：</p><blockquote><p>A popstate event is dispatched to the window each time <strong>the active history entry changes</strong> between two history entries for <strong>the same document</strong>.</p></blockquote><p>即，在同一文档的内的两个历史记录中，激活的记录改变了，该事件就会被触发。</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>很多文章中说，点击浏览器的 <em>前进</em> 和 <em>后退</em> 按钮，就会触发 <code>popstate</code> 事件，实际上不严谨的。如果不是在同一个 document 内进行的跳转，是不会触发这个事件的。
比如，我们用下面的代码监听 popstate 事件：</p><div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function-variable function">onpopstate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;location: &quot;</span> <span class="token operator">+</span> document<span class="token punctuation">.</span>location <span class="token operator">+</span> <span class="token string">&quot;, state: &quot;</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当我们在浏览器的地址栏输入一个另一个页面的 url(这两个页面不同属于一个 document)，然后使用 <em>后退</em> 按钮，并不能触发该事件。</p></div><h3 id="state"><a href="#state" aria-hidden="true" class="header-anchor">#</a> state</h3><p>当监听了 <code>popstate</code> 事件触发后，可以获取到当前激活历史记录的 <code>state</code>(即 <code>event.state</code>)。这个状态实际上是传入 <code>history.pushState()</code> 或 <code>history.replaceState()</code> 的第一个参数的一份拷贝。此外，都为 <code>null</code>。</p><p><code>state</code> 可以是任何可序列化的对象。设计的目的，实际上就是状态标记，标记当前激活的历史记录的状态。尤其是当我们调用 <code>history.pushState()</code> 或 <code>history.replaceState()</code> 时，并不会触发 <code>popstate</code> 事件。</p><p>至于为什么会提供这样的得一个 state，官方的解释<a href="https://www.w3.org/TR/html50/browsers.html#state-object" target="_blank" rel="noopener noreferrer">在这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><blockquote><p>State objects are intended to be used for two main purposes: first, storing a preparsed description of the state in the URL so that in the simple case an author doesn't have to do the parsing (though one would still need the parsing for handling URLs passed around by users, so it's only a minor optimization), and second, so that the author can store state that one wouldn't store in the URL because it only applies to the current Document instance and it would have to be reconstructed if a new Document were opened.</p></blockquote><p>简而言之，就是能够不必解析 url 就能直接获取当前记录的一个状态。</p><h2 id="history-pushstate-history-replacestate"><a href="#history-pushstate-history-replacestate" aria-hidden="true" class="header-anchor">#</a> history.pushState()/history.replaceState()</h2><p>这两个 API 分别用来增加或修改当前记录的。<code>pushState()</code> 类似于在栈顶的位置增加一条记录，而 <code>replaceState()</code> 是修改当前激活的记录。两者并不会直接触发 <code>popstate</code> 事件，也不会导致页面重载。</p><p>两个 API 都接收三个参数：</p><ul><li><code>state</code> - 即上面提到的 state</li><li><code>title</code> - 暂时没有定义用户</li><li><code>url</code> - 可选参数。这个参数值得注意的有这么几点：
<ol><li>可以是相对路径，或者绝对路径。但必须和当前的 url <strong>满足同源策略</strong>。</li><li>参数是可选的，如果没有，就和当前的 url 一致， 但是仍然 <strong>会往栈顶添加或修改一条记录</strong>。</li></ol></li></ul><p>举个例子：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 当前页面的地址为: http://xiaokedada.com。history.length 为 1。</span>
history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'xiaoke'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'xiaokedada'</span><span class="token punctuation">)</span>
history<span class="token punctuation">.</span>length <span class="token comment">// 2</span>
history<span class="token punctuation">.</span>state <span class="token comment">// { name: 'xiaoke' }</span>
</code></pre></div><p><code>history.pushState()</code> 和 <code>history.replaceState()</code> 的一个典型应用场景是 <a href="https://www.zhangxinxu.com/wordpress/2013/06/html5-history-api-pushstate-replacestate-ajax/" target="_blank" rel="noopener noreferrer"><strong>无刷新改变页面内容</strong><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p><h2 id="hash-和-history-实现前端路由"><a href="#hash-和-history-实现前端路由" aria-hidden="true" class="header-anchor">#</a> hash 和 history 实现前端路由</h2><p>在前端的 SPA 应用中，前端路由系统通过改变 url，可以在不重新请求页面的情况下更新页面视图。</p><p>方式一，是通过 <code>location.hash</code>。</p><h3 id="location-hash"><a href="#location-hash" aria-hidden="true" class="header-anchor">#</a> location.hash</h3><p>首先，通过 hash，也可以在 history stack 中创建一个记录。</p><div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash <span class="token operator">=</span> <span class="token string">&quot;#foo&quot;</span>

<span class="token comment">// or</span>

window<span class="token punctuation">.</span>location <span class="token operator">=</span> <span class="token string">&quot;#bar&quot;</span>
</code></pre></div><p>值得注意的是：</p><ol><li>hash 部分不会包含在 http 请求中，只是页面中的一个 <em>锚点</em>。</li><li>只有当设置的 hash 值和当前的 hash 值不同，才会创建一个新的历史记录。而 <code>history.pushState()</code> 和 <code>history.replaceState()</code>，在不提供额外的 url 参数时，仍会添加或修改一条记录。</li><li>hash 的改变也会触发 <code>popstate</code> 事件。</li></ol><p>所以，在通过 hash 的方式来实现前端路由的时候。可以通过 <code>location.hash</code> 配合 <code>hashchange</code>/<code>popstate</code> 事件来实现。</p><h3 id="history"><a href="#history" aria-hidden="true" class="header-anchor">#</a> history</h3><p>history 是另一种实现前端路由的方式，主要是通过 <code>history.pushState()</code> 和 <code>history.replaceState()</code> 配合 <code>popstate</code> 事件来实现的。</p><p>同时也有以下特点：</p><ol><li>即便和原地址相比，只是多了 fragment identifier (即 hash 部分) 的内容，也不会触发 <code>hashchange</code> 事件。</li><li>通过使用 <code>state</code>，能提供更多的任意信息。而 hash 方式必须全部包含在字符串中。</li><li>当用户刷新页面时，新的 url 会作为请求发送给后端，因此需要响应的后端配置。</li></ol><blockquote><p><a href="https://router.vuejs.org/guide/essentials/history-mode.html#html5-history-mode" target="_blank" rel="noopener noreferrer">Vue-Router - HTML5 History Mode<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote><p><a href="https://router.vuejs.org/" target="_blank" rel="noopener noreferrer">Vue-Router<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 对上述的两种方法都做了实现。具体可参考<a href="https://github.com/vuejs/vue-router" target="_blank" rel="noopener noreferrer">官方源代码<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，或者以下源代码分析的文章。</p><ul><li><a href="https://zhuanlan.zhihu.com/p/27588422" target="_blank" rel="noopener noreferrer">从vue-router看前端路由的两种实现<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://zhuanlan.zhihu.com/p/24574970" target="_blank" rel="noopener noreferrer">vue-router 源码分析-history<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://zhuanlan.zhihu.com/p/24104410" target="_blank" rel="noopener noreferrer">vue-router源码分析-整体流程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><h2 id="参考"><a href="#参考" aria-hidden="true" class="header-anchor">#</a> 参考</h2><p>文中很多内容来自 MDN 相关的解释。其中有一个例子非常好：</p><div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function-variable function">onpopstate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;location: &quot;</span> <span class="token operator">+</span> document<span class="token punctuation">.</span>location <span class="token operator">+</span> <span class="token string">&quot;, state: &quot;</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>page<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;title 1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;?page=1&quot;</span><span class="token punctuation">)</span>
history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>page<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;title 2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;?page=2&quot;</span><span class="token punctuation">)</span>
history<span class="token punctuation">.</span><span class="token function">replaceState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>page<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;title 3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;?page=3&quot;</span><span class="token punctuation">)</span>
history<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
history<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
history<span class="token punctuation">.</span><span class="token function">go</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre></div><p>部分内容来自 <a href="https://developer.mozilla.org/en-US/docs/Web/API/History_API" target="_blank" rel="noopener noreferrer">Manipulating the browser history<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div><div class="page-edit"><div class="edit-link"><a href="https://github.com/maoxiaoke/xiaokedada/edit/master/JavaScript/DOM-History.md" target="_blank" rel="noopener noreferrer">在 Github 上编辑此页</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/JavaScript/DOM-More.html" class="prev">
          再来仔细研究DOM
        </a></span><span class="next"><a href="/JavaScript/Small-and-Chunk-Code.html">
          书写有用而优雅的代码
        </a> →
      </span></p></div></div></div></div>
    <script src="/assets/js/37.21574b04.js" defer></script><script src="/assets/js/app.843b634b.js" defer></script>
  </body>
</html>
