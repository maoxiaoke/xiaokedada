<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>有关代码重构和整洁之道 | XIAOKEDADA</title>
    <meta name="description" content="Write something useful and funny">
    <link rel="icon" href="/favicon.png">
    
    <link rel="preload" href="/assets/css/68.styles.d3eb3505.css" as="style"><link rel="preload" href="/assets/js/app.843b634b.js" as="script"><link rel="preload" href="/assets/js/11.8fc6b13a.js" as="script"><link rel="prefetch" href="/assets/js/35.fc0649b6.js"><link rel="prefetch" href="/assets/js/1.85421567.js"><link rel="prefetch" href="/assets/js/2.f423fd68.js"><link rel="prefetch" href="/assets/js/3.1f142fb1.js"><link rel="prefetch" href="/assets/js/4.bd68aee8.js"><link rel="prefetch" href="/assets/js/5.0a465bdb.js"><link rel="prefetch" href="/assets/js/6.97e629f1.js"><link rel="prefetch" href="/assets/js/7.bb19bdef.js"><link rel="prefetch" href="/assets/js/8.5daef4ca.js"><link rel="prefetch" href="/assets/js/9.4fcb0f34.js"><link rel="prefetch" href="/assets/js/10.4376478b.js"><link rel="prefetch" href="/assets/js/12.1772ec65.js"><link rel="prefetch" href="/assets/js/13.a4ef0e77.js"><link rel="prefetch" href="/assets/js/14.427f03c9.js"><link rel="prefetch" href="/assets/js/15.723a7d06.js"><link rel="prefetch" href="/assets/js/16.166d836c.js"><link rel="prefetch" href="/assets/js/17.21b4f630.js"><link rel="prefetch" href="/assets/js/18.fd756ec4.js"><link rel="prefetch" href="/assets/js/19.a8b80d16.js"><link rel="prefetch" href="/assets/js/20.8e9cdb67.js"><link rel="prefetch" href="/assets/js/21.4e4f2b91.js"><link rel="prefetch" href="/assets/js/22.d28267a3.js"><link rel="prefetch" href="/assets/js/23.653fa423.js"><link rel="prefetch" href="/assets/js/24.8ed99de7.js"><link rel="prefetch" href="/assets/js/25.614045fd.js"><link rel="prefetch" href="/assets/js/26.02791f7a.js"><link rel="prefetch" href="/assets/js/27.3fa3f1e9.js"><link rel="prefetch" href="/assets/js/28.8aaaacba.js"><link rel="prefetch" href="/assets/js/29.02e1b211.js"><link rel="prefetch" href="/assets/js/30.46e3e02b.js"><link rel="prefetch" href="/assets/js/31.8af56ad3.js"><link rel="prefetch" href="/assets/js/32.091d8ef1.js"><link rel="prefetch" href="/assets/js/33.d33fb871.js"><link rel="prefetch" href="/assets/js/34.d41761e9.js"><link rel="prefetch" href="/assets/js/0.e6be7c2e.js"><link rel="prefetch" href="/assets/js/36.d0053b92.js"><link rel="prefetch" href="/assets/js/37.21574b04.js"><link rel="prefetch" href="/assets/js/38.80e207ae.js"><link rel="prefetch" href="/assets/js/39.e4995ccf.js"><link rel="prefetch" href="/assets/js/40.5d361e67.js"><link rel="prefetch" href="/assets/js/41.a50cd60b.js"><link rel="prefetch" href="/assets/js/42.caf66f0e.js"><link rel="prefetch" href="/assets/js/43.4a9eaf80.js"><link rel="prefetch" href="/assets/js/44.448792e0.js"><link rel="prefetch" href="/assets/js/45.a2c7b618.js"><link rel="prefetch" href="/assets/js/46.d5711dfe.js"><link rel="prefetch" href="/assets/js/47.b7c59a32.js"><link rel="prefetch" href="/assets/js/48.d54390f0.js"><link rel="prefetch" href="/assets/js/49.0e14e323.js"><link rel="prefetch" href="/assets/js/50.116c6f8c.js"><link rel="prefetch" href="/assets/js/51.00a2e7ea.js"><link rel="prefetch" href="/assets/js/52.96b8f0e2.js"><link rel="prefetch" href="/assets/js/53.6316d91b.js"><link rel="prefetch" href="/assets/js/54.3120e195.js"><link rel="prefetch" href="/assets/js/55.7582a732.js"><link rel="prefetch" href="/assets/js/56.eab8bc2a.js"><link rel="prefetch" href="/assets/js/57.74edb44a.js"><link rel="prefetch" href="/assets/js/58.5122e2dc.js"><link rel="prefetch" href="/assets/js/59.3ec0162a.js"><link rel="prefetch" href="/assets/js/60.8ec70531.js"><link rel="prefetch" href="/assets/js/61.fc7a010b.js"><link rel="prefetch" href="/assets/js/62.e17877aa.js"><link rel="prefetch" href="/assets/js/63.44b0382a.js"><link rel="prefetch" href="/assets/js/64.621d7404.js"><link rel="prefetch" href="/assets/js/65.755ec884.js"><link rel="prefetch" href="/assets/js/66.bfb5a72d.js"><link rel="prefetch" href="/assets/js/67.b71bf6f3.js">
    <link rel="stylesheet" href="/assets/css/68.styles.d3eb3505.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      XIAOKEDADA
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/JavaScript/" class="nav-link router-link-active">JavaScript</a></div><div class="nav-item"><a href="/FirstMeet/" class="nav-link">FirstMeet系列</a></div><div class="nav-item"><a href="/CSS/" class="nav-link">CSS</a></div><div class="nav-item"><a href="/ReadingNote/" class="nav-link">读书笔记</a></div><div class="nav-item"><a href="/GatherAll/" class="nav-link">R &amp; T</a></div><a href="https://github.com/maoxiaoke/xiaokedada" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/JavaScript/" class="nav-link router-link-active">JavaScript</a></div><div class="nav-item"><a href="/FirstMeet/" class="nav-link">FirstMeet系列</a></div><div class="nav-item"><a href="/CSS/" class="nav-link">CSS</a></div><div class="nav-item"><a href="/ReadingNote/" class="nav-link">读书笔记</a></div><div class="nav-item"><a href="/GatherAll/" class="nav-link">R &amp; T</a></div><a href="https://github.com/maoxiaoke/xiaokedada" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>Depth-in-Series</span><!----></p><ul class="sidebar-group-items"><li><a href="/JavaScript/Require-and-Import.html" class="sidebar-link">require 和 import 的难点</a></li><li><a href="/JavaScript/Property-Descriptors.html" class="sidebar-link">JavaScript 对象的 Property descriptors</a></li><li><a href="/JavaScript/Depth-in-ES6.html" class="sidebar-link">深入理解 ES6</a></li><li><a href="/JavaScript/Depth-in-This.html" class="sidebar-link">this 的挑战</a></li><li><a href="/JavaScript/Depth-in-Closure.html" class="sidebar-link">来一次痛痛快快得闭包挑战</a></li><li><a href="/JavaScript/Async-Programming.html" class="sidebar-link">JavaScript 异步编程</a></li><li><a href="/JavaScript/Prototype.html" class="sidebar-link">再谈原型和继承</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Re-learn ES6</span><!----></p><ul class="sidebar-group-items"><li><a href="/JavaScript/ES6-Let-and-Const.html" class="sidebar-link">最佳实践，使用 let/const</a></li><li><a href="/JavaScript/ES6-Class.html" class="sidebar-link">近似 Class 的操作</a></li><li><a href="/JavaScript/ES6-Symbols.html" class="sidebar-link">万物皆不同 - Symbols</a></li><li><a href="/JavaScript/ES6-Iterator-And-Iterable.html" class="sidebar-link">迭代协议</a></li><li><a href="/JavaScript/ES6-Async.html" class="sidebar-link">异步编程要点</a></li><li><a href="/JavaScript/ES6-Generator.html" class="sidebar-link">Generator</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Light FP</span><!----></p><ul class="sidebar-group-items"><li><a href="/JavaScript/Light-FP-Overview.html" class="sidebar-link">Light-FP 概念篇</a></li><li><a href="/JavaScript/Light-FP-Categries.html" class="sidebar-link">范畴学基础理论</a></li><li><a href="/JavaScript/Light-FP-Compose.html" class="sidebar-link">Compose</a></li><li><a href="/JavaScript/Light-FP-Container-And-Functor.html" class="sidebar-link">Container and Functor</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>基础内容</span><!----></p><ul class="sidebar-group-items"><li><a href="/JavaScript/AJAX.html" class="sidebar-link">AJAX</a></li><li><a href="/JavaScript/Coercion.html" class="sidebar-link">强制类型转换</a></li><li><a href="/JavaScript/Map-and-Reduce.html" class="sidebar-link">JavaScript 的 map/reduce</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>DOM 相关</span><!----></p><ul class="sidebar-group-items"><li><a href="/JavaScript/DOM-Operation.html" class="sidebar-link">原生JavaScript的DOM操作</a></li><li><a href="/JavaScript/DOM-More.html" class="sidebar-link">再来仔细研究DOM</a></li><li><a href="/JavaScript/DOM-History.html" class="sidebar-link">和 URL 相关的 Location 和 History</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>Thinking-in-JavaScript</span><!----></p><ul class="sidebar-group-items"><li><a href="/JavaScript/Small-and-Chunk-Code.html" class="sidebar-link">书写有用而优雅的代码</a></li><li><a href="/JavaScript/I-Dont-Know-JavaScript.html" class="sidebar-link">你看到的 JavaScript，并不是真实的</a></li><li><a href="/JavaScript/Refactor-JavaScript.html" class="active sidebar-link">有关代码重构和整洁之道</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#代码层面的整洁之道" class="sidebar-link">代码层面的整洁之道</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#使用-const-而不是-let" class="sidebar-link">使用 const 而不是 let</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#采用易于理解的名称来表示常量" class="sidebar-link">采用易于理解的名称来表示常量</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#遵循一种命名规范" class="sidebar-link">遵循一种命名规范</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#显式优于隐式" class="sidebar-link">显式优于隐式</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#限制参数个数" class="sidebar-link">限制参数个数</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#使用携带默认参数的函数" class="sidebar-link">使用携带默认参数的函数</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#使用-rest-参数而不是-arguments" class="sidebar-link">使用 rest 参数而不是 arguments</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#函数的单一职责" class="sidebar-link">函数的单一职责</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#移除重复和多余的代码" class="sidebar-link">移除重复和多余的代码</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#不要使用标记作为函数参数" class="sidebar-link">不要使用标记作为函数参数</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#避免副作用-纯函数" class="sidebar-link">避免副作用 - 纯函数</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#非侵入性地改造函数" class="sidebar-link">非侵入性地改造函数</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#使用-lookup-table-取代-switch" class="sidebar-link">使用 Lookup Table 取代 switch</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#条件判断中提前-return-似乎是可取的" class="sidebar-link">条件判断中提前 return 似乎是可取的</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#条件判断中使用-短路-运算符似乎是可取的" class="sidebar-link">条件判断中使用 短路 运算符似乎是可取的</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#当判断条件包含-或" class="sidebar-link">当判断条件包含 &gt; 或 &lt;</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#封装判断条件" class="sidebar-link">封装判断条件</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#不要省略" class="sidebar-link">不要省略 {}</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#避免无意义的条件判断" class="sidebar-link">避免无意义的条件判断</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#避免“否定”情况的判断" class="sidebar-link">避免“否定”情况的判断</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#避免修改原对象" class="sidebar-link">避免修改原对象</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#避免过度优化" class="sidebar-link">避免过度优化</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#远离-callback-hell" class="sidebar-link">远离 callback hell</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#避免嵌套-promise" class="sidebar-link">避免嵌套 Promise</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#返回-promise-链的-“尾巴”" class="sidebar-link">返回 Promise 链的 “尾巴”</a></li></ul></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#promise-的-then-链总该返回什么" class="sidebar-link">Promise 的 then 链总该返回什么</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#不要“吞掉”-error" class="sidebar-link">不要“吞掉” Error</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#基于-promise-的函数不应当-throw-异常" class="sidebar-link">基于 Promise 的函数不应当 throw 异常</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#使用-error-对象" class="sidebar-link">使用 Error 对象</a></li></ul></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#改变认知，成为专业人士" class="sidebar-link">改变认知，成为专业人士</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#solid" class="sidebar-link">SOLID</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#grasp" class="sidebar-link">GRASP</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#don-t-repeat-yourself-dry" class="sidebar-link">Don't repeat yourself - DRY</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#kiss" class="sidebar-link">KISS</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#inversion-of-control-控制反转" class="sidebar-link">Inversion of control - 控制反转</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#loose-coupling-high-cohesion-高耦合低内聚" class="sidebar-link">loose coupling high cohesion - 高耦合低内聚</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#yagni-ya-ain-t-gonna-need-it-你不会用到它的" class="sidebar-link">YAGNI(ya ain't gonna need it) - 你不会用到它的</a></li><li class="sidebar-sub-header"><a href="/JavaScript/Refactor-JavaScript.html#principle-of-least-surprise-最小意外原则" class="sidebar-link">Principle of least surprise - 最小意外原则</a></li></ul></li><li><a href="/JavaScript/JavaScript-Design-Pattern.html" class="sidebar-link">设计模式</a></li></ul></div></li></ul></div><div class="page"><div class="content"><h1 id="有关代码重构和整洁之道"><a href="#有关代码重构和整洁之道" aria-hidden="true" class="header-anchor">#</a> 有关代码重构和整洁之道</h1><p>TODO:</p><ul><li>[ ] 补充 class、prototype 等相关的</li><li>[ ] 差错控制</li></ul><h2 id="代码层面的整洁之道"><a href="#代码层面的整洁之道" aria-hidden="true" class="header-anchor">#</a> 代码层面的整洁之道</h2><p>扩展：</p><ul><li><a href="https://github.com/ryanmcdermott/clean-code-javascript" target="_blank" rel="noopener noreferrer">clean-code-javascript<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li><a href="https://github.com/i0natan/nodebestpractices" target="_blank" rel="noopener noreferrer">nodebestpractices<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul><p>🍑 <span style="font-size: 18px;font-weight: 700">基本</span></p><h3 id="使用-const-而不是-let"><a href="#使用-const-而不是-let" aria-hidden="true" class="header-anchor">#</a> 使用 const 而不是 let</h3><p>当声明变量的时候，<code>const</code> 是<strong>首要选择</strong>，而不是 <code>let</code>。而对于 Object、Array、Set、Map、函数表达式、类表达式等，除需要进行赋值操作之外，选用 <code>const</code>。</p><p><code>for...of</code> 中的循环变变量，使用 <code>const</code>。</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 反例</span>
<span class="token keyword">let</span> order <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
order<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token string">'123456'</span>

<span class="token comment">// 正例</span>
<span class="token keyword">const</span> order <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
order<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token string">'123456'</span>
</code></pre></div><h3 id="采用易于理解的名称来表示常量"><a href="#采用易于理解的名称来表示常量" aria-hidden="true" class="header-anchor">#</a> 采用易于理解的名称来表示常量</h3><p>是代码拥有良好的可读性非常重要。一般，我们会用大写名称来定义一些常量。</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 反例</span>
<span class="token keyword">function</span> <span class="token function">timeLevel</span> <span class="token punctuation">(</span>exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 11 是什么</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      label<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">parseInt</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token operator">+</span> exception<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 分钟`</span></span><span class="token punctuation">,</span>
      value<span class="token punctuation">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token operator">+</span> exception
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 正例</span>
<span class="token keyword">const</span> <span class="token constant">TIME_LEVEL</span> <span class="token operator">=</span> <span class="token number">11</span>
<span class="token keyword">function</span> <span class="token function">timeLevel</span> <span class="token punctuation">(</span>exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token constant">TIME_LEVEL</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      label<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">parseInt</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token operator">+</span> exception<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 分钟`</span></span><span class="token punctuation">,</span>
      value<span class="token punctuation">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token operator">+</span> exception
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="遵循一种命名规范"><a href="#遵循一种命名规范" aria-hidden="true" class="header-anchor">#</a> 遵循一种命名规范</h3><p>社区约定的使用 <em>大驼峰</em>、<em>小驼峰</em> 命名当然是毋庸置疑的。然而，对变量、函数名、类名等如何「取名字」，并没有较好的社区方案。只有一些建议：</p><ol><li>准确、精简</li></ol><p>「取名字」尽量有准确的单词或短语。比如 <code>addOrder</code> 并不是很好的命名，<em>添加</em> 操作可以是 <em>插入</em> 或 <em>附加</em>，也就是说使用 <code>insertOrder</code> 或 <code>appendOrder</code> 是更为准确的。</p><p>「取名字」应当尽量精简。太长的名字阅读起来特别费力，当你遇到这种不得不起很长名字时候，是不是应该多思考一下。</p><ol start="2"><li>功能明确</li></ol><p>函数应该功能明确，通过函数名就能够准确获得函数信息和返回值信息。比如 <code>isEmpty()</code> 清晰地告诉我们，该函数检查 something 是否为空，并返回 boolean 值。</p><ol start="3"><li>统一标准</li></ol><p>统一函数的「名字」，如果选择 <code>fetchUserInfo</code> 来表达获取来自后端返回的数据，你就不应该在其他地方选择 <code>getCustomerType</code> 作为函数名。</p><p>对于，对于「取名字」这件事，「It depends」。</p><p>下面是我对自己的一些约定。</p><ol><li>变量名应该是 「名词或者名词短语」，函数名应该是 「动词或动词短语」。</li><li>常量应该全部大写。</li><li>能用「缩略词」明确表达含义的，尽量使用「缩略词」。</li><li>函数名尽可能使用一些常见的约定。</li></ol><table><thead><tr><th style="text-align:center">动词</th><th style="text-align:center">含义</th><th style="text-align:center">举例</th></tr></thead><tbody><tr><td style="text-align:center">fetch</td><td style="text-align:center">获取 API 数据</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">is</td><td style="text-align:center">判断某一条件</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">can</td><td style="text-align:center">表达某种能力</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">set</td><td style="text-align:center">赋值</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">edit</td><td style="text-align:center">编辑</td><td style="text-align:center">editPanleVisible</td></tr><tr><td style="text-align:center">register</td><td style="text-align:center">在某处注册函数</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">dispatch</td><td style="text-align:center">分发某一操作</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">hidden</td><td style="text-align:center">隐藏</td><td style="text-align:center">hiddenPanle</td></tr><tr><td style="text-align:center">gotIt</td><td style="text-align:center">知道了</td><td style="text-align:center"></td></tr></tbody></table><ol start="5"><li>需要为 <code>this</code> 更名的地方，使用 <code>context</code>，而不是 <code>that</code> 或 <code>_this</code><sup>1</sup>。</li></ol><h3 id="显式优于隐式"><a href="#显式优于隐式" aria-hidden="true" class="header-anchor">#</a> 显式优于隐式</h3><p>不要绕太多弯子。</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 反例</span>
<span class="token keyword">function</span> <span class="token function">fetchNewOrder</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'xxx'</span><span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
           <span class="token comment">// xxx</span>
         <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 正例</span>
<span class="token keyword">function</span> <span class="token function">fetchNewOrder</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'xxx'</span><span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>order <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
           <span class="token comment">// xxx</span>
         <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>🍎 <span style="font-size: 18px;font-weight: 700">函数相关</span></p><h3 id="限制参数个数"><a href="#限制参数个数" aria-hidden="true" class="header-anchor">#</a> 限制参数个数</h3><p>限制函数参数很有必要，这样做使得在测试函数的时更加轻松。</p><p>应避免三个以上参数的函数，通常情况下，参数超过两个意味着函数功能过于复杂，这个时候，应该做的事重新优化你的函数。</p><p>如果确实需要很多参数，可以考虑将这些参数封装成一个对象。</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 反例</span>
fuction <span class="token function">printOrder</span> <span class="token punctuation">(</span>order<span class="token punctuation">,</span> orderState<span class="token punctuation">,</span> orderTips<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>

<span class="token comment">//正例</span>
<span class="token keyword">function</span> <span class="token function">printOrder</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>order<span class="token punctuation">,</span> orderState<span class="token punctuation">,</span> orderTips <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="使用携带默认参数的函数"><a href="#使用携带默认参数的函数" aria-hidden="true" class="header-anchor">#</a> 使用携带默认参数的函数</h3><p>尽可能地使用 ES6 语法。使用携带默认参数的函数替代 <code>||</code> 运算符。</p><blockquote><p><code>||</code> 运算符的<a href="https://xiaoke.faas.ele.me/JavaScript/Depth-in-ES6.html#%E5%87%BD%E6%95%B0%E7%9A%84%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96" target="_blank" rel="noopener noreferrer">怪异性<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 反例</span>
<span class="token keyword">function</span> <span class="token function">printOrder</span> <span class="token punctuation">(</span>order<span class="token punctuation">,</span> autoConfirm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  order <span class="token operator">=</span> order <span class="token operator">||</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token string">'123456'</span><span class="token punctuation">,</span> city<span class="token punctuation">:</span> <span class="token string">'NanKing'</span> <span class="token punctuation">}</span>
  autoConfirm <span class="token operator">=</span> autoConfirm <span class="token operator">||</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>

<span class="token comment">//正例</span>
<span class="token keyword">const</span> defalutOrder <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> <span class="token string">'123456'</span><span class="token punctuation">,</span>
  city<span class="token punctuation">:</span> <span class="token string">'NanKing'</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">printOrder</span> <span class="token punctuation">(</span>order <span class="token operator">=</span> defalutOrder<span class="token punctuation">,</span> autoConfirm <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="使用-rest-参数而不是-arguments"><a href="#使用-rest-参数而不是-arguments" aria-hidden="true" class="header-anchor">#</a> 使用 rest 参数而不是 arguments</h3><p>arguments 在非严格模式下，具有<a href="https://xiaoke.faas.ele.me/JavaScript/Depth-in-ES6.html#%E5%87%BD%E6%95%B0%E7%9A%84%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96" target="_blank" rel="noopener noreferrer">怪异性<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p>尽可能地使用 rest 参数替代 arguments。</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 反例</span>
<span class="token keyword">function</span> <span class="token function">sum</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> first <span class="token operator">=</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> second <span class="token operator">=</span> arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> third <span class="token operator">=</span> arguments<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
  <span class="token keyword">return</span> first <span class="token operator">+</span> second <span class="token operator">+</span> third
<span class="token punctuation">}</span>
<span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>

<span class="token comment">//正例</span>
<span class="token keyword">function</span> <span class="token function">sum</span> <span class="token punctuation">(</span><span class="token operator">...</span>arg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span> first<span class="token punctuation">,</span> second<span class="token punctuation">,</span> third <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token operator">...</span>arg <span class="token punctuation">]</span>
  <span class="token keyword">return</span> first <span class="token operator">+</span> second <span class="token operator">+</span> third
<span class="token punctuation">}</span>
<span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="函数的单一职责"><a href="#函数的单一职责" aria-hidden="true" class="header-anchor">#</a> 函数的单一职责</h3><p>功能不单一的函数将难以重构、测试和理解。</p><p>TODO:</p><ul><li>[ ] 如何定义单一职责(即，只做一件事)</li></ul><h3 id="移除重复和多余的代码"><a href="#移除重复和多余的代码" aria-hidden="true" class="header-anchor">#</a> 移除重复和多余的代码</h3><p>一定要移除项目中重复和多余的代码。</p><h3 id="不要使用标记作为函数参数"><a href="#不要使用标记作为函数参数" aria-hidden="true" class="header-anchor">#</a> 不要使用标记作为函数参数</h3><p>这通常意味着函数的单一职责已经被破坏了。这个时候，应当考虑对函数进行再次划分。</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 反例</span>
<span class="token keyword">function</span> <span class="token function">genIdentifier</span> <span class="token punctuation">(</span>comment<span class="token punctuation">,</span> isArray<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isArray<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> comment<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span> <span class="token operator">+</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>comment<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span> <span class="token operator">+</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>comment<span class="token punctuation">.</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 正例</span>
<span class="token keyword">function</span> <span class="token function">genIdentifier</span> <span class="token punctuation">(</span>comment<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>comment<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span> <span class="token operator">+</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>comment<span class="token punctuation">.</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">genIdentifierList</span> <span class="token punctuation">(</span>commentList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> commentList<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>comment <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>comment<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span> <span class="token operator">+</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>comment<span class="token punctuation">.</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当然，这有争论。我们当然希望一个函数能够提供完整的功能，这虽然不能覆盖所有的情形，但对于 “小” 函数而言，应该是可取的。</p><p>在 [非侵入性地改造函数](### 非侵入性地改造函数) 从业务的角度避免传入一个用于「判断」的 token。</p><h3 id="避免副作用-纯函数"><a href="#避免副作用-纯函数" aria-hidden="true" class="header-anchor">#</a> 避免副作用 - 纯函数</h3><p>函数式编程具有更干净和便于测试的特点。纯函数有以下属性<sup>8</sup>：</p><ul><li>其结果只能从它的参数的值来计算</li><li>不能改变外部状态</li><li>不能依赖于能被外部操作改变的数据</li></ul><h3 id="非侵入性地改造函数"><a href="#非侵入性地改造函数" aria-hidden="true" class="header-anchor">#</a> 非侵入性地改造函数</h3><p>当我们试图向函数传入一个用于「判断」的 token 时，我们应当注意，函数已经违背了 <em>只做一件事</em>。</p><p>比如，当我们需要为 <code>userInfo</code> 添加一道缓存：即如果再次请求同一个用户的信息，就不用重新向服务器发送请求，而直接使用第一次请求的数据返回<sup>5</sup>。</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">renderUser</span> <span class="token operator">=</span> <span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// User representation</span>
<span class="token punctuation">}</span>

<span class="token comment">// 反例</span>
<span class="token keyword">const</span> userInfoCache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">fetchUserInfo</span> <span class="token operator">=</span> <span class="token punctuation">(</span>userId<span class="token punctuation">,</span> renderUser<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>userInfoCache<span class="token punctuation">[</span>userId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">renderUser</span><span class="token punctuation">(</span>userInfoCache<span class="token punctuation">[</span>userId<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`https://api.github.com/users/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> userId <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>info <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">renderUser</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 正例</span>
<span class="token keyword">const</span> <span class="token function-variable function">fetchUserInfo</span> <span class="token operator">=</span> <span class="token punctuation">(</span>userId<span class="token punctuation">,</span> renderUser<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`https://api.github.com/users/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> userId <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>info <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">renderUser</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">memorizeThunk</span> <span class="token operator">=</span> <span class="token punctuation">(</span>func<span class="token punctuation">,</span> reducer<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>userId<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> key <span class="token operator">=</span> <span class="token function">reducer</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">callback</span><span class="token punctuation">(</span>cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">func</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> res <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        cache<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> res
        <span class="token function">callback</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> fetchUserInfoCache <span class="token operator">=</span> <span class="token function">memorizeThunk</span><span class="token punctuation">(</span>fetchUserInfo<span class="token punctuation">,</span> <span class="token punctuation">(</span>userId<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> userId<span class="token punctuation">)</span>
<span class="token function">fetchUserInfoCache</span><span class="token punctuation">(</span><span class="token string">'maoxiaoke'</span><span class="token punctuation">,</span> renderUser<span class="token punctuation">)</span>
</code></pre></div><p>实际原理还是将函数拆解为更小的「功能单一」的函数。</p><p>🍊 <span style="font-size: 18px;font-weight: 700">Control Flow 相关</span></p><h3 id="使用-lookup-table-取代-switch"><a href="#使用-lookup-table-取代-switch" aria-hidden="true" class="header-anchor">#</a> 使用 Lookup Table 取代 switch</h3><p>可以使用 Lookup Table 取代冗长的 <code>switch</code> 表达式。为了实现一个 Lookup Table，可以选择 <code>Object</code> 或 <code>Map</code>。</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 反例</span>
<span class="token keyword">function</span> <span class="token function">queryPolling</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span><span class="token punctuation">:</span> <span class="token string">'2m'</span>
      <span class="token function">pollingFor2Min</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">break</span>
    <span class="token keyword">case</span><span class="token punctuation">:</span> <span class="token string">'5m'</span>
      <span class="token function">pollingFor5Min</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">break</span>
    <span class="token keyword">case</span><span class="token punctuation">:</span> <span class="token string">'9m'</span>
      <span class="token function">pollingFor9Min</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">break</span>
    defalut
      <span class="token keyword">break</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 正例</span>
<span class="token keyword">const</span> lookupTable <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'2m'</span><span class="token punctuation">:</span> pollingFor2Min<span class="token punctuation">,</span>
  <span class="token string">'5m'</span><span class="token punctuation">:</span> pollingFor5Min<span class="token punctuation">,</span>
  <span class="token string">'9m'</span><span class="token punctuation">:</span> pollingFor9Min
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">queryPolling</span> <span class="token operator">=</span> type <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  lookupTable<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 正例</span>
<span class="token keyword">const</span> lookupTable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token string">'2m'</span><span class="token punctuation">,</span> pollingFor2Min<span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'5m'</span><span class="token punctuation">,</span> pollingFor5Min<span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'9m'</span><span class="token punctuation">,</span> pollingFor9Min<span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">queryPolling</span> <span class="token operator">=</span> type <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  lookupTable<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>值得注意的是，当代码中引入了 <code>this</code>，有时候会需要使用 <code>call()</code> 或 <code>apply()</code> 绑定上下文。</p><h3 id="条件判断中提前-return-似乎是可取的"><a href="#条件判断中提前-return-似乎是可取的" aria-hidden="true" class="header-anchor">#</a> 条件判断中提前 return 似乎是可取的</h3><p>当我们的 <code>if</code> 判断中存在大量的代码，或者有大量的 <code>if</code> 嵌套，提前 <code>return</code> 似乎是一个不错的选择。</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 反例</span>
<span class="token keyword">function</span> <span class="token function">queryOrder</span> <span class="token punctuation">(</span>existence<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>existence<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// a large piece of code, more than 3 ~ 4 lines</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// just a line of code</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 正例</span>
<span class="token keyword">function</span> <span class="token function">queryOrder</span> <span class="token punctuation">(</span>existence<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  cosnt notExistence <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>existence
  <span class="token keyword">if</span> <span class="token punctuation">(</span>notExistence<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// just a line of code</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// a large piece of code, more than 3 ~ 4 lines</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当然，有批评认为：“当你的 if 语句中有一大段代码，这说明你最应该先做的是根据函数的单一性原则，将函数抽成更下的函数”。</p><p>另有批评赞同了「提前 return」，同时也补充：“在函数最外层最开始提前 return 是可取的，但在一个复杂的函数中间 return。当你重构你的代码时，你会感到很痛苦。”<sup>2</sup></p><p>所以在 「条件判断中提前 return」的说法中，你应该有所取舍，「It depends!」</p><h3 id="条件判断中使用-短路-运算符似乎是可取的"><a href="#条件判断中使用-短路-运算符似乎是可取的" aria-hidden="true" class="header-anchor">#</a> 条件判断中使用 <em>短路</em> 运算符似乎是可取的</h3><p>当只需要 <code>if</code> 用于条件判断时，可以使用 <em>短路</em> 运算符减少代码行数。</p><p><code>if</code> 条件为真，利用 <code>&amp;&amp;</code> 运算符；<code>if</code> 条件为假，利用 <code>||</code> 运算符。</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 反例</span>
<span class="token keyword">function</span> <span class="token function">queryOrder</span> <span class="token punctuation">(</span>existence<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>existence<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">deleteExistOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 正例</span>
<span class="token keyword">function</span> <span class="token function">queryOrder</span> <span class="token punctuation">(</span>existence<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  existence <span class="token operator">&amp;&amp;</span> <span class="token function">deleteExistOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>实际上，如果是不习惯使用 <em>短路</em> 运算符的用户，上述的代码也并非清晰明了 - 这是一种有争论的做法。</p><p>因此，有些批评认为，<strong>显式优于隐式</strong>：“完整 <code>if...else</code> 很有必要，哪怕 <code>else</code> 中什么也不做，你也应该说明”。</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 反例</span>
<span class="token keyword">function</span> <span class="token function">queryOrder</span> <span class="token punctuation">(</span>existence<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>existence<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">deleteExistOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 正例</span>
<span class="token keyword">function</span> <span class="token function">queryOrder</span> <span class="token punctuation">(</span>existence<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>existence<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">deleteExistOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do nothing</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>还是那句话，「It depends」。</p><h3 id="当判断条件包含-或"><a href="#当判断条件包含-或" aria-hidden="true" class="header-anchor">#</a> 当判断条件包含 &gt; 或 &lt;</h3><h3 id="封装判断条件"><a href="#封装判断条件" aria-hidden="true" class="header-anchor">#</a> 封装判断条件</h3><p>会遇到很多情况，需要 <code>if</code> 判断中加入多个判断条件。可以将多个判断条件封装起来 - 尤其是拥有超过 2 个判断条件的情况。</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 反例</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> isEmpty <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lodash'</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>order<span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">'CANCEL'</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>unprocessedOrderList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Do something</span>
<span class="token punctuation">}</span>

<span class="token comment">// 正例</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> isEmpty <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lodash'</span>
<span class="token keyword">const</span> <span class="token function-variable function">canActivateTone</span> <span class="token operator">=</span> <span class="token punctuation">(</span>order<span class="token punctuation">,</span> unprocessedOrderList<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> order<span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">'CANCEL'</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>unprocessedOrderList<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">canActivateTone</span><span class="token punctuation">(</span>order<span class="token punctuation">,</span> unprocessedOrderList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Do something</span>
<span class="token punctuation">}</span>
</code></pre></div><p>以下情形并不考虑在「封装判断条件」之内：</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>order <span class="token operator">&amp;&amp;</span> order<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Do something</span>
<span class="token punctuation">}</span>
</code></pre></div><p>已经有一个提案<sup>6</sup>来支持 <code>order?.id</code> 这种写法，但是目前最好的方案是使用 <a href="https://lodash.com/" target="_blank" rel="noopener noreferrer">Lodash<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的 <a href="https://lodash.com/docs/4.17.11#get" target="_blank" rel="noopener noreferrer"><code>get</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 方法。</p><h3 id="不要省略"><a href="#不要省略" aria-hidden="true" class="header-anchor">#</a> 不要省略 {}</h3><p>为了代码 “整洁”，常常一行代码完成 <code>if</code> 判断。但是我觉得 <code>if... else</code> 配上 <code>{}</code>「非常酷」。</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 反例</span>
<span class="token keyword">function</span> <span class="token function">fetchShopDetail</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isInGrey</span><span class="token punctuation">(</span>shopId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
<span class="token punctuation">}</span>

<span class="token comment">// 正例</span>
<span class="token keyword">function</span> <span class="token function">fetchShopDetail</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isInGrey</span><span class="token punctuation">(</span>shopId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="避免无意义的条件判断"><a href="#避免无意义的条件判断" aria-hidden="true" class="header-anchor">#</a> 避免无意义的条件判断</h3><p>有些情况，需要根据条件将变量赋值为 <code>boolean</code> 值。可以避免使用 <code>if</code> 来作为条件判断。</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 反例</span>
<span class="token keyword">const</span> showLocalDeadline <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">===</span> <span class="token string">'equal'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  showLocalDeadline <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  showLocalDeadline <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>

<span class="token comment">// 正例</span>
<span class="token keyword">const</span> showLocalDeadline <span class="token operator">=</span> val <span class="token operator">!==</span> <span class="token string">'equal'</span>
</code></pre></div><blockquote><p>这是一种会被认为压根不用考虑的情形，而实际上(尤其是&quot;疲劳&quot;编码的时候)，往往会写出这样的代码。</p></blockquote><h3 id="避免“否定”情况的判断"><a href="#避免“否定”情况的判断" aria-hidden="true" class="header-anchor">#</a> 避免“否定”情况的判断</h3><p>要尽力避免“否定”情况的判断。否定情况的判断，会让代码的阅读性降低，也容易出错。</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 反例</span>
<span class="token keyword">function</span> <span class="token function">isPlainObject</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isPlainObject</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>

<span class="token comment">// 正例</span>
<span class="token keyword">function</span> <span class="token function">isPlainObject</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPlainObject</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>🍒  <span style="font-size: 18px;font-weight: 700">代码层面</span></p><h3 id="避免修改原对象"><a href="#避免修改原对象" aria-hidden="true" class="header-anchor">#</a> 避免修改原对象</h3><p>避免修改对象，采用更为 immutable 的实现。</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 反例</span>
<span class="token keyword">const</span> order <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> <span class="token string">'xxx'</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token punctuation">(</span>order<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  order<span class="token punctuation">.</span>shopId <span class="token operator">=</span> <span class="token string">'xxx'</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>

<span class="token comment">// 正例</span>
<span class="token keyword">const</span> order <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> <span class="token string">'xxx'</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token punctuation">(</span>order<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> newOrder <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>order<span class="token punctuation">,</span> shopId<span class="token punctuation">:</span> <span class="token string">'xxx'</span> <span class="token punctuation">}</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>

<span class="token comment">// 反例</span>
<span class="token function">addCouponInfos</span> <span class="token punctuation">(</span>target<span class="token punctuation">,</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> target<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>comment <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    comment<span class="token punctuation">.</span>extendsInfo <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>coupon <span class="token operator">=&gt;</span> coupon<span class="token punctuation">.</span>id <span class="token operator">===</span> comment<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> comment
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 正例</span>
<span class="token function">addCouponInfos</span> <span class="token punctuation">(</span>target<span class="token punctuation">,</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> target<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>comment <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> extendsInfo <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>coupon <span class="token operator">=&gt;</span> coupon<span class="token punctuation">.</span>id <span class="token operator">===</span> comment<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token operator">...</span>comment<span class="token punctuation">,</span> extendsInfo <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>若是多层级嵌套的对象，更方便的方式是使用 Lodash 的 <a href="https://lodash.com/docs/4.17.10#cloneDeep" target="_blank" rel="noopener noreferrer"><code>cloneDeep</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p><h3 id="避免过度优化"><a href="#避免过度优化" aria-hidden="true" class="header-anchor">#</a> 避免过度优化</h3><p>保证代码的可读性非常重要。除了特别的情况<sup>3</sup>，完全可以将优化交给浏览器来处理。</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 反例</span>
<span class="token keyword">const</span> <span class="token constant">TIME_LEVEL</span> <span class="token operator">=</span> <span class="token number">11</span>
<span class="token keyword">function</span> <span class="token function">timeLevel</span> <span class="token punctuation">(</span>exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> emptyArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> timeLevelArr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    emptyArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      label<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">parseInt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> exception<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 分钟`</span></span><span class="token punctuation">,</span>
      value<span class="token punctuation">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> exception
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 正例</span>
<span class="token keyword">const</span> <span class="token constant">TIME_LEVEL</span> <span class="token operator">=</span> <span class="token number">11</span>
<span class="token keyword">function</span> <span class="token function">timeLevel</span> <span class="token punctuation">(</span>exception<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token constant">TIME_LEVEL</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      label<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">parseInt</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token operator">+</span> exception<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 分钟`</span></span><span class="token punctuation">,</span>
      value<span class="token punctuation">:</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token operator">+</span> exception
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>🥝 <span style="font-size: 18px;font-weight: 700">异步控制</span></p><h3 id="远离-callback-hell"><a href="#远离-callback-hell" aria-hidden="true" class="header-anchor">#</a> 远离 callback hell</h3><p>TODO:</p><ul><li>[ ] Add description and example</li></ul><h3 id="避免嵌套-promise"><a href="#避免嵌套-promise" aria-hidden="true" class="header-anchor">#</a> 避免嵌套 Promise</h3><p>避免嵌套 Promise。嵌套的 Promise 会导致代码混乱<sup>7</sup>。</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 反例</span>
<span class="token keyword">function</span> <span class="token function">printOrder</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">getGlobalSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>settings <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">getCurrentProfile</span><span class="token punctuation">(</span>settings<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>profile <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 正例</span>
<span class="token keyword">function</span> <span class="token function">printOrder</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">getGlobalSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>settings <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">getCurrentProfile</span><span class="token punctuation">(</span>settings<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>profile<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="返回-promise-链的-“尾巴”"><a href="#返回-promise-链的-“尾巴”" aria-hidden="true" class="header-anchor">#</a> 返回 Promise 链的 “尾巴”</h3><p>对于 Promise 链，“千万” 不要返回链的 “第一个”。对于每一个 <code>then</code> 链，尽量返回 “一些什么”，以避免返回的 <code>[[Promise.value]]</code> 为 <code>undefined</code>。</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 反例</span>
<span class="token keyword">function</span> <span class="token function">printOrder</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token function">haveAvailablePrinters</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>printer <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> promise
<span class="token punctuation">}</span>

<span class="token comment">// 正例</span>
<span class="token keyword">function</span> <span class="token function">printOrder</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">haveAvailablePrinters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>printer <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token keyword">return</span> something
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="promise-的-then-链总该返回什么"><a href="#promise-的-then-链总该返回什么" aria-hidden="true" class="header-anchor">#</a> Promise 的 then 链总该返回什么</h2><p>Promise 的 then 链如果没有返回 Promise、一般值或者 thenable 的话，会将 <code>undefined</code> 作为 resolved 值返回(假设没有任何 catch 捕获到错误)。当排查问题的时候，这样的错误会极难发现。</p><p>TODO:</p><ul><li>[ ] Add example</li></ul><h2 id="不要“吞掉”-error"><a href="#不要“吞掉”-error" aria-hidden="true" class="header-anchor">#</a> 不要“吞掉” Error</h2><p>「Promise 链的最后总以一个 <code>catch()</code> 结束」是一个最佳实践。但设计一个基于 Promise 的函数时，应该考虑的是让函数自己进行差错控制处理呢，还是抛错。绝不要“吞掉”错误。</p><p>tips: 请理解这里的措辞 “吞掉”。当试图在函数进行差错控制时，你也应当有 <code>catch</code> 操作，显式处理；当试图将 Error 提供给外部使用时，你就不应该 “吞掉” 它。</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 反例</span>
<span class="token keyword">function</span> <span class="token function">printOrderByTpl</span> <span class="token punctuation">(</span>printers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>printers<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">printOrder</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> e<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 可能是正例</span>
<span class="token keyword">function</span> <span class="token function">printOrderByTpl</span> <span class="token punctuation">(</span>printers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>printers<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">printOrder</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>tips: 可能认为下面的这两种方式表达的方式一致。</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// then 链后没有 catch</span>
<span class="token keyword">function</span> <span class="token function">printOrderByTpl</span> <span class="token punctuation">(</span>printers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>printers<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">printOrder</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// then 链后有 catch</span>
<span class="token keyword">function</span> <span class="token function">printOrderByTpl</span> <span class="token punctuation">(</span>printers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>printers<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">printOrder</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e <span class="token operator">=&gt;</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我认为这两种表达并不一致：当设计一个基于 Promise 的函数时，提供的信任方案是向外显式 <code>resolve</code> 或 <code>reject</code>。若认为向外 “throw error” 也是提供一个 <code>reject</code>，那实际上就是与 Promise 的设计思想背道而驰；另外，&quot;错误&quot; 是普遍的，很多情况下都无法确定 “错误” 的来源，而 <code>reject</code> 是确定的。</p><h2 id="基于-promise-的函数不应当-throw-异常"><a href="#基于-promise-的函数不应当-throw-异常" aria-hidden="true" class="header-anchor">#</a> 基于 Promise 的函数不应当 throw 异常</h2><p>http://2ality.com/2016/03/promise-rejections-vs-exceptions.html</p><p>🍊 <span style="font-size: 18px;font-weight: 700">差错控制</span></p><h3 id="使用-error-对象"><a href="#使用-error-对象" aria-hidden="true" class="header-anchor">#</a> 使用 Error 对象</h3><p>使用 <em>字符串</em> 或 <em>简单对象</em> 作为异常信息没有太多价值<sup>4</sup>。不妨使用 JavaScript 的 <code>Error</code> 对象。</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 反例</span>
<span class="token keyword">function</span> <span class="token function">printOrder</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span> error<span class="token punctuation">:</span> <span class="token punctuation">{</span> message<span class="token punctuation">:</span> <span class="token string">'请检查打印机相关设置'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 正例</span>
<span class="token keyword">function</span> <span class="token function">printOrder</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'请检查打印机相关设置'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="改变认知，成为专业人士"><a href="#改变认知，成为专业人士" aria-hidden="true" class="header-anchor">#</a> 改变认知，成为专业人士</h2><ol><li><p>让别人读懂你的代码很重要</p></li><li><p>「如果有坑，别挖」</p></li><li><p>「“无情” 重构」</p></li></ol><ul><li>[ ] 业务迭代，修改一个函数，而不是添加几行代码</li></ul><h2 id="solid"><a href="#solid" aria-hidden="true" class="header-anchor">#</a> SOLID</h2><p>来自书本「Agile Software Development: Principles, Patterns, and Practices」- Martin, Robert C</p><h2 id="grasp"><a href="#grasp" aria-hidden="true" class="header-anchor">#</a> GRASP</h2><p>来自书本「Applying UML and Patterns」- Craig Larman</p><p>https://www.cnblogs.com/pangjianxin/p/7928083.html</p><h2 id="don-t-repeat-yourself-dry"><a href="#don-t-repeat-yourself-dry" aria-hidden="true" class="header-anchor">#</a> Don't repeat yourself - DRY</h2><h2 id="kiss"><a href="#kiss" aria-hidden="true" class="header-anchor">#</a> KISS</h2><h2 id="inversion-of-control-控制反转"><a href="#inversion-of-control-控制反转" aria-hidden="true" class="header-anchor">#</a> Inversion of control - 控制反转</h2><h2 id="loose-coupling-high-cohesion-高耦合低内聚"><a href="#loose-coupling-high-cohesion-高耦合低内聚" aria-hidden="true" class="header-anchor">#</a> loose coupling high cohesion - 高耦合低内聚</h2><h2 id="yagni-ya-ain-t-gonna-need-it-你不会用到它的"><a href="#yagni-ya-ain-t-gonna-need-it-你不会用到它的" aria-hidden="true" class="header-anchor">#</a> YAGNI(ya ain't gonna need it) - 你不会用到它的</h2><h2 id="principle-of-least-surprise-最小意外原则"><a href="#principle-of-least-surprise-最小意外原则" aria-hidden="true" class="header-anchor">#</a> Principle of least surprise - 最小意外原则</h2><p>[1] https://gist.github.com/cjohansen/4135065</p><p>[2] http://blog.timoxley.com/post/47041269194/avoid-else-return-early</p><p>[3] https://github.com/petkaantonov/bluebird/wiki/Optimization-killers</p><p>[4] https://www.bennadel.com/blog/2828-creating-custom-error-objects-in-node-js-with-error-capturestacktrace.htm</p><p>[5] http://taobaofed.org/blog/2017/01/05/writing-readable-code/</p><p>[6] https://github.com/tc39/proposal-optional-chaining</p><p>[7] http://taoofcode.net/promise-anti-patterns/</p><p>[8] Functional JavaScript - Michael Fogus</p></div><div class="page-edit"><div class="edit-link"><a href="https://github.com/maoxiaoke/xiaokedada/edit/master/JavaScript/Refactor-JavaScript.md" target="_blank" rel="noopener noreferrer">在 Github 上编辑此页</a><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        ← <a href="/JavaScript/I-Dont-Know-JavaScript.html" class="prev">
          你看到的 JavaScript，并不是真实的
        </a></span><span class="next"><a href="/JavaScript/JavaScript-Design-Pattern.html">
          设计模式
        </a> →
      </span></p></div></div></div></div>
    <script src="/assets/js/11.8fc6b13a.js" defer></script><script src="/assets/js/app.843b634b.js" defer></script>
  </body>
</html>
